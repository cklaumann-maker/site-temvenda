<!DOCTYPE html>
<html lang="pt-BR">
<head>
    
        <link rel="icon" type="image/png" href="/favicon-32.png" sizes="32x32">
                <link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" type="image/png" href="/favicon-32.png" sizes="16x16">
        <link rel="apple-touch-icon" href="/favicon-32.png" sizes="180x180">
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEM VENDA - Admin - Estat√≠sticas [v3.7-1762076713]</title>
    <!-- VERS√ÉO 3.7 - Stats.html atualizado em 02/11/2025 06:45 - Corre√ß√£o null check em updateLogosUpload
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Configura√ß√µes do Supabase - Projeto TEM VENDA (inline para garantir carregamento)
        window.SUPABASE_CONFIG = {
            url: 'https://mgcoyeohqelystqmytah.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1nY295ZW9ocWVseXN0cW15dGFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2NzAzNjQsImV4cCI6MjA3NzI0NjM2NH0.KBKHH10DaV0m5SroFmXsTedS_dalcAprKnUOI4Unkx4',
            serviceKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1nY295ZW9ocWVseXN0cW15dGFoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTY3MDM2NCwiZXhwIjoyMDc3MjQ2MzY0fQ.wylX0wMD5teTcADuUvU81R1bft3pftGhhU-BGKYv9TQ'
        };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --tv-white: #FFFFFF;
            --tv-black: #000000;
            --tv-gray-light: #F8F9FA;
            --tv-gray-medium: #666666;
            --tv-gray-dark: #2D2D2D;
            --tv-gray-border: #E5E5E5;
            --tv-green: #5ee100;
            --tv-success: #51cf66;
            --tv-warning: #ff8c00;
            --tv-danger: #ff4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--tv-white);
            color: var(--tv-black);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 32px;
            margin: 0;
            overflow-x: hidden;
        }

        /* Ajustes quando carregado em iframe */
        @media (max-width: 1600px) {
            body {
                padding: 24px;
            }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 48px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--tv-gray-border);
        }

        .header h1 {
            font-size: 36px;
            font-weight: 800;
            color: var(--tv-black);
            margin-bottom: 12px;
        }

        .header p {
            color: var(--tv-gray-medium);
            font-size: 18px;
            font-weight: 400;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--tv-green);
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 24px;
            transition: all 0.3s ease;
            padding: 8px 16px;
            border: 1px solid var(--tv-green);
            border-radius: 6px;
        }

        .back-link:hover {
            background: var(--tv-green);
            color: var(--tv-white);
        }

        .stats-form {
            background: var(--tv-white);
            border: 1px solid var(--tv-gray-border);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--tv-black);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            background: var(--tv-white);
            border: 1px solid var(--tv-gray-border);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--tv-black);
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--tv-green);
            box-shadow: 0 0 0 3px rgba(94, 225, 0, 0.1);
        }

        .form-group small {
            color: var(--tv-gray-medium);
            font-size: 13px;
            margin-top: 6px;
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
        }

        .btn-save {
            background: var(--tv-green);
            color: var(--tv-black);
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-save:hover {
            background: #4bc800;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(94,225,0,0.3);
        }

        .current-stats {
            background: var(--tv-white);
            border: 1px solid var(--tv-gray-border);
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .current-stats h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--tv-black);
            margin-bottom: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
        }

        .stat-item {
            text-align: center;
            padding: 24px;
            background: var(--tv-gray-light);
            border-radius: 12px;
            border: 1px solid var(--tv-gray-border);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 900;
            color: var(--tv-green);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--tv-gray-medium);
            font-weight: 500;
        }

        .success-message {
            background: rgba(94,225,0,0.1);
            border: 1px solid var(--tv-green);
            border-radius: 8px;
            padding: 16px 20px;
            margin-bottom: 24px;
            color: var(--tv-black);
            font-weight: 500;
            display: none;
            text-align: left;
            line-height: 1.6;
            white-space: pre-line;
        }
        
        .success-message strong {
            color: var(--tv-black);
            font-weight: 700;
            display: block;
            margin-bottom: 8px;
        }
        
        .success-message ul {
            margin: 8px 0;
            padding-left: 24px;
        }
        
        .success-message li {
            margin: 4px 0;
        }

        .image-upload-section {
            background: var(--tv-white);
            border: 1px solid var(--tv-gray-border);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .image-upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .image-upload-item {
            border: 2px dashed var(--tv-gray-border);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            background: var(--tv-gray-light);
            overflow: visible !important;
            min-height: auto !important;
            max-height: none !important;
        }

        .image-upload-item:hover {
            border-color: var(--tv-green);
            background: rgba(94, 225, 0, 0.05);
        }

        .image-upload-item.dragover {
            border-color: var(--tv-green);
            background: rgba(94, 225, 0, 0.1);
        }

        .image-upload-item h4 {
            font-size: 16px;
            font-weight: 700;
            color: var(--tv-black);
            margin-bottom: 8px;
        }

        .image-upload-item p {
            font-size: 13px;
            color: var(--tv-gray-medium);
            margin-bottom: 16px;
        }

        .image-upload-item img {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .image-upload-item .placeholder {
            width: 100%;
            height: 120px;
            background: var(--tv-gray-border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            color: var(--tv-gray-medium);
            font-size: 14px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: var(--tv-green);
            color: var(--tv-black);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .upload-btn:hover {
            background: #4bc800;
            transform: translateY(-1px);
        }

        /* Garantir visibilidade dos bot√µes de PDF */
        #btn-download-pdf,
        #btn-refresh-pdf {
            display: inline-block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 10 !important;
            width: auto !important;
            height: auto !important;
            min-width: 200px !important;
            min-height: 40px !important;
            padding: 12px 24px !important;
            margin: 8px 4px !important;
            line-height: normal !important;
            font-size: 14px !important;
        }
        
        /* Garantir que container n√£o esconda bot√µes */
        .image-upload-item {
            overflow: visible !important;
            min-height: auto !important;
        }

        .remove-btn {
            background: var(--tv-danger);
            color: var(--tv-white);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .remove-btn:hover {
            background: #e63946;
        }

        .admin-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--tv-gray-medium);
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            padding: 8px 16px;
            border: 1px solid var(--tv-gray-border);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .admin-link:hover {
            color: var(--tv-green);
            border-color: var(--tv-green);
        }

        @media (max-width: 768px) {
            body {
                padding: 16px;
            }

            .header h1 {
                font-size: 28px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .admin-links {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Administra√ß√£o - Estat√≠sticas</h1>
        </div>

        <div class="success-message" id="successMessage">
            ‚úÖ Estat√≠sticas atualizadas com sucesso!
        </div>

        <div class="image-upload-section">
            <h3 style="color: var(--tv-black); font-size: 18px; font-weight: 700; margin-bottom: 20px;">üñºÔ∏è Gerenciar Imagens das P√°ginas</h3>
            <div class="image-upload-grid">
                <div class="image-upload-item" data-image="formacao-lider">
                    <h4>Forma√ß√£o - L√≠der</h4>
                    <p>Imagem para se√ß√£o "L√≠der" na p√°gina de forma√ß√£o</p>
                    <div class="image-preview" id="preview-formacao-lider">
                        <div class="placeholder">Nenhuma imagem selecionada</div>
                    </div>
                    <input type="file" class="file-input" id="file-formacao-lider" accept="image/*">
                    <button class="upload-btn" onclick="document.getElementById('file-formacao-lider').click()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Selecionar Imagem
                    </button>
                    <button class="upload-btn" style="margin-left:8px" onclick="confirmSave('formacao-lider')">Salvar imagem</button>
                    <button class="remove-btn" onclick="removeImage('formacao-lider')" style="display: none;">Remover</button>
                </div>

                <div class="image-upload-item" data-image="formacao-cesar">
                    <h4>Forma√ß√£o - Cesar</h4>
                    <p>Imagem para se√ß√£o "Cesar" na p√°gina de forma√ß√£o</p>
                    <div class="image-preview" id="preview-formacao-cesar">
                        <div class="placeholder">Nenhuma imagem selecionada</div>
                    </div>
                    <input type="file" class="file-input" id="file-formacao-cesar" accept="image/*">
                    <button class="upload-btn" onclick="document.getElementById('file-formacao-cesar').click()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7,10 12 15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Selecionar Imagem
                    </button>
                    <button class="upload-btn" style="margin-left:8px" onclick="confirmSave('formacao-cesar')">Salvar imagem</button>
                    <button class="remove-btn" onclick="removeImage('formacao-cesar')" style="display: none;">Remover</button>
                </div>

                <div class="image-upload-item" data-image="palestras-hero">
                    <h4>Palestras - Hero</h4>
                    <p>Imagem principal da p√°gina de palestras</p>
                    <div class="image-preview" id="preview-palestras-hero">
                        <div class="placeholder">Nenhuma imagem selecionada</div>
                    </div>
                    <input type="file" class="file-input" id="file-palestras-hero" accept="image/*">
                    <button class="upload-btn" onclick="document.getElementById('file-palestras-hero').click()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Selecionar Imagem
                    </button>
                    <button class="upload-btn" style="margin-left:8px" onclick="confirmSave('palestras-hero')">Salvar imagem</button>
                    <button class="remove-btn" onclick="removeImage('palestras-hero')" style="display: none;">Remover</button>
                </div>

                <div class="image-upload-item" data-image="palestras-cesar">
                    <h4>Palestras - Cesar</h4>
                    <p>Imagem do palestrante na p√°gina de palestras</p>
                    <div class="image-preview" id="preview-palestras-cesar">
                        <div class="placeholder">Nenhuma imagem selecionada</div>
                    </div>
                    <input type="file" class="file-input" id="file-palestras-cesar" accept="image/*">
                    <button class="upload-btn" onclick="document.getElementById('file-palestras-cesar').click()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Selecionar Imagem
                    </button>
                    <button class="upload-btn" style="margin-left:8px" onclick="confirmSave('palestras-cesar')">Salvar imagem</button>
                    <button class="remove-btn" onclick="removeImage('palestras-cesar')" style="display: none;">Remover</button>
                </div>

                <div class="image-upload-item" data-image="treinamento-hero">
                    <h4>Treinamento In-Company - Hero</h4>
                    <p>Imagem principal da p√°gina de treinamento in-company</p>
                    <div class="image-preview" id="preview-treinamento-hero">
                        <div class="placeholder">Nenhuma imagem selecionada</div>
                    </div>
                    <input type="file" class="file-input" id="file-treinamento-hero" accept="image/*">
                    <button class="upload-btn" onclick="document.getElementById('file-treinamento-hero').click()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Selecionar Imagem
                    </button>
                    <button class="upload-btn" style="margin-left:8px" onclick="confirmSave('treinamento-hero')">Salvar imagem</button>
                    <button class="remove-btn" onclick="removeImage('treinamento-hero')" style="display: none;">Remover</button>
                </div>
            </div>
        </div>

        <form class="stats-form" id="statsForm">
            <h3 style="color: var(--tv-black); font-size: 18px; font-weight: 700; margin-bottom: 20px;">üìä Estat√≠sticas dos Clientes (Parte Superior)</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="gestores-treinados">Gestores Treinados</label>
                    <input type="text" id="gestores-treinados" name="gestores-treinados" placeholder="Ex: +300" required>
                    <small>N√∫mero de gestores que j√° foram treinados</small>
                </div>
                
                <div class="form-group">
                    <label for="nps-clientes">NPS dos Clientes</label>
                    <input type="text" id="nps-clientes" name="nps-clientes" placeholder="Ex: 9,6" required>
                    <small>Net Promoter Score m√©dio dos clientes</small>
                </div>
                
                <div class="form-group">
                    <label for="redes-parceiras">Clientes Parceiros</label>
                    <input type="text" id="redes-parceiras" name="redes-parceiras" placeholder="Ex: 3" required>
                    <small>N√∫mero de clientes parceiros</small>
                </div>
            </div>
            
            <h3 style="color: var(--tv-black); font-size: 18px; font-weight: 700; margin: 32px 0 20px 0;">üñºÔ∏è Logos de Clientes Parceiros</h3>
            <div class="form-group">
                <label>Upload de Logos</label>
                <small style="display: block; margin-bottom: 12px; color: var(--tv-gray-medium);">
                    A quantidade de logos ser√° baseada no n√∫mero de clientes parceiros acima.
                </small>
                <div id="logosUploadContainer" style="display: flex; flex-direction: column; gap: 12px;">
                    <!-- Inputs de upload ser√£o gerados dinamicamente -->
                </div>
                <button type="button" id="addLogoBtn" style="margin-top: 12px; padding: 8px 16px; background: var(--tv-gray-medium); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                    + Adicionar Logo
                </button>
                <small style="display: block; margin-top: 8px; color: var(--tv-gray-medium); font-size: 11px;">
                    üìã Formatos aceitos: JPG, PNG, GIF, WEBP, SVG (m√°x. 5MB antes da compress√£o)<br>
                    üìè Dimens√µes recomendadas: 400x200px (ser√° redimensionado automaticamente)
                </small>
            </div>
            
            <h3 style="color: var(--tv-black); font-size: 18px; font-weight: 700; margin: 32px 0 20px 0;">üë®‚Äçüíº Estat√≠sticas Pessoais (Se√ß√£o Sobre Mim)</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="anos-experiencia">Anos de Experi√™ncia</label>
                    <input type="text" id="anos-experiencia" name="anos-experiencia" placeholder="Ex: 20" required>
                    <small>Anos de experi√™ncia no mercado farmac√™utico</small>
                </div>
                
                <div class="form-group">
                    <label for="faturamento-anual">Faturamento Anual</label>
                    <input type="text" id="faturamento-anual" name="faturamento-anual" placeholder="Ex: R$ 2bi" required>
                    <small>Faturamento anual no √∫ltimo ano de gest√£o</small>
                </div>
                
                <div class="form-group">
                    <label for="pessoas-geridas">Pessoas Geridas</label>
                    <input type="text" id="pessoas-geridas" name="pessoas-geridas" placeholder="Ex: 150+" required>
                    <small>Time diretamente gerido em opera√ß√µes comerciais</small>
                </div>
                
                <div class="form-group">
                    <label for="inicio-mercado">In√≠cio no Mercado</label>
                    <input type="text" id="inicio-mercado" name="inicio-mercado" placeholder="Ex: 1998" required>
                    <small>Ano de in√≠cio no mercado farmac√™utico</small>
                </div>
            </div>
            
            <button type="submit" class="btn-save">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                    <polyline points="17,21 17,13 7,13 7,21"/>
                    <polyline points="7,3 7,8 15,8"/>
                </svg>
                Salvar Estat√≠sticas
            </button>
        </form>

        <div class="current-stats">
            <h3>üìà Estat√≠sticas Atuais</h3>
            <h4 style="color: var(--tv-gray-dark); font-size: 16px; font-weight: 600; margin: 20px 0 16px 0;">üìä Clientes</h4>
            <div class="stats-grid" id="currentStatsClients">
                <!-- Ser√° preenchido via JavaScript -->
            </div>
            <h4 style="color: var(--tv-gray-dark); font-size: 16px; font-weight: 600; margin: 20px 0 16px 0;">üë®‚Äçüíº Pessoais</h4>
            <div class="stats-grid" id="currentStatsPersonal">
                <!-- Ser√° preenchido via JavaScript -->
            </div>
        </div>

        <div class="image-upload-section">
            <h3 style="color: var(--tv-black); font-size: 18px; font-weight: 700; margin-bottom: 20px;">üì± P√°gina de Captura Instagram</h3>
            <p style="color: var(--tv-gray-medium); margin-bottom: 24px;">Gerencie o conte√∫do e PDF da p√°gina de captura de leads do Instagram.</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-bottom: 32px;">
                <div>
                    <h4 style="color: var(--tv-black); font-size: 16px; font-weight: 600; margin-bottom: 16px;">Configura√ß√µes de Texto</h4>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: var(--tv-black);">T√≠tulo Principal:</label>
                        <input type="text" id="instagram-main-title" placeholder="E-book Gratuito" style="width: 100%; padding: 12px; border: 1px solid var(--tv-gray-border); border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: var(--tv-black);">Subt√≠tulo:</label>
                        <input type="text" id="instagram-main-subtitle" placeholder="Descubra os segredos do sucesso empresarial" style="width: 100%; padding: 12px; border: 1px solid var(--tv-gray-border); border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: var(--tv-black);">Benef√≠cio 1:</label>
                        <input type="text" id="instagram-benefit-1" placeholder="Estrat√©gias comprovadas para aumentar suas vendas" style="width: 100%; padding: 12px; border: 1px solid var(--tv-gray-border); border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: var(--tv-black);">Benef√≠cio 2:</label>
                        <input type="text" id="instagram-benefit-2" placeholder="Como identificar e converter leads qualificados" style="width: 100%; padding: 12px; border: 1px solid var(--tv-gray-border); border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: var(--tv-black);">Benef√≠cio 3:</label>
                        <input type="text" id="instagram-benefit-3" placeholder="T√©cnicas de negocia√ß√£o que realmente funcionam" style="width: 100%; padding: 12px; border: 1px solid var(--tv-gray-border); border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: var(--tv-black);">Benef√≠cio 4:</label>
                        <input type="text" id="instagram-benefit-4" placeholder="Como escalar seu neg√≥cio de forma sustent√°vel" style="width: 100%; padding: 12px; border: 1px solid var(--tv-gray-border); border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: var(--tv-black);">Texto do Bot√£o:</label>
                        <input type="text" id="instagram-button-text" placeholder="Baixar E-book Gratuito" style="width: 100%; padding: 12px; border: 1px solid var(--tv-gray-border); border-radius: 8px; font-size: 14px;">
                    </div>
                    
                    <button onclick="saveInstagramConfig()" class="upload-btn" style="width: 100%;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                            <polyline points="17,21 17,13 7,13 7,21"/>
                            <polyline points="7,3 7,8 15,8"/>
                        </svg>
                        Salvar Configura√ß√µes
                    </button>
                </div>
                
                <div>
                    <h4 style="color: var(--tv-black); font-size: 16px; font-weight: 600; margin-bottom: 16px;">E-book PDF</h4>
                    
                    <div class="image-upload-item" style="margin-bottom: 16px; overflow: visible !important; min-height: auto !important; max-height: none !important;">
                        <div class="image-preview" id="preview-pdf">
                            <div class="placeholder">Nenhum PDF carregado</div>
                        </div>
                        <input type="file" class="file-input" id="file-pdf" accept=".pdf" onchange="handlePdfUpload()">
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 12px; width: 100%;">
                            <button class="upload-btn" onclick="document.getElementById('file-pdf').click()" style="width: 100%;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                            Selecionar PDF
                        </button>
                            <button id="btn-download-pdf" class="upload-btn" onclick="downloadPdfFromDatabase()" style="background: #667eea !important; display: inline-block !important; visibility: visible !important; opacity: 1 !important; width: 100% !important; min-width: 200px !important; min-height: 44px !important; padding: 12px 24px !important; margin: 0 !important;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                üì• Baixar PDF do Banco
                            </button>
                            <button id="btn-refresh-pdf" class="upload-btn" onclick="loadPdfPreview()" style="background: #28a745 !important; display: inline-block !important; visibility: visible !important; opacity: 1 !important; width: 100% !important; min-width: 200px !important; min-height: 44px !important; padding: 12px 24px !important; margin: 0 !important;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"/>
                                    <polyline points="1 20 1 14 7 14"/>
                                    <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                                </svg>
                                üîÑ Atualizar Status do PDF
                            </button>
                        </div>
                        <div id="pdf-status-info" style="font-size: 12px; color: var(--tv-gray-medium); margin-top: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px; display: none;"></div>
                        <button class="remove-btn" onclick="removePdf()" style="display: none;">Remover PDF</button>
                    </div>
                    
                    <div style="background: var(--tv-gray-light); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                        <h5 style="color: var(--tv-black); font-size: 14px; font-weight: 600; margin-bottom: 8px;">Preview da P√°gina</h5>
                        <p style="color: var(--tv-gray-medium); font-size: 13px; margin-bottom: 12px;">Visualize como a p√°gina de captura est√° ficando:</p>
                        <a href="/instagram" target="_blank" class="upload-btn" style="width: 100%; text-decoration: none; display: inline-block; text-align: center;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
                                <polyline points="15,3 21,3 21,9"/>
                                <line x1="10" y1="14" x2="21" y2="3"/>
                            </svg>
                            Ver P√°gina de Captura
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/auth-manager.js"></script>
    <script>
        // ============================================
        // INST√ÇNCIA √öNICA DO SUPABASE (evita m√∫ltiplas inst√¢ncias)
        // ============================================
        let supabaseClientAnon = null;
        let supabaseClientService = null;
        
        function getSupabaseClientAnon() {
            if (!supabaseClientAnon && window.SUPABASE_CONFIG) {
                const { createClient } = supabase;
                supabaseClientAnon = createClient(
                    window.SUPABASE_CONFIG.url,
                    window.SUPABASE_CONFIG.anonKey
                );
            }
            return supabaseClientAnon;
        }
        
        function getSupabaseClientService() {
            if (!supabaseClientService && window.SUPABASE_CONFIG?.serviceKey) {
                const { createClient } = supabase;
                supabaseClientService = createClient(
                    window.SUPABASE_CONFIG.url,
                    window.SUPABASE_CONFIG.serviceKey
                );
            }
            return supabaseClientService;
        }
        
        // Verificar autentica√ß√£o ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            if (!window.authManager.checkAuth()) {
                return; // Redirecionar√° para login
            }
            
            // Verificar permiss√£o espec√≠fica
            if (!window.authManager.requirePermission('manage_stats')) {
                return; // Mostrar√° erro e redirecionar√°
            }
            
            // Mostrar bot√£o de usu√°rios apenas para quem tem permiss√£o
            const usersButton = document.getElementById('usersButton');
            if (usersButton && window.authManager.hasPermission('manage_users')) {
                usersButton.style.display = 'inline-flex';
            }
            
            // Controlar acesso √†s se√ß√µes baseado em permiss√µes
            setupPermissionControls();
            
            // Continuar com o carregamento normal da p√°gina
            loadCurrentStats();
            loadStatsToForm();
            loadImages();
            setupImageUploads();
            loadInstagramConfig();
            loadPdfPreview();
            // Listener para upload de PDF da captura
            const pdfInput = document.getElementById('file-pdf');
            if (pdfInput) {
                pdfInput.addEventListener('change', function(e){
                    if (e.target.files && e.target.files[0]) {
                        handlePdfUpload();
                    }
                });
            }
        });

        // Fun√ß√£o de logout
        function logout() {
            window.authManager.logout();
        }

        // Configurar controles de permiss√£o
        function setupPermissionControls() {
            const user = window.authManager.getCurrentUser();
            
            // Controlar acesso √† se√ß√£o de estat√≠sticas
            if (!window.authManager.hasPermission('manage_stats')) {
                const statsSection = document.querySelector('.stats-section');
                if (statsSection) {
                    statsSection.style.display = 'none';
                }
            }
            
            // Controlar acesso √† se√ß√£o de imagens
            if (!window.authManager.hasPermission('manage_images')) {
                const imageSection = document.querySelector('.image-upload-section');
                if (imageSection) {
                    imageSection.style.display = 'none';
                }
            }
            
            // Controlar acesso √† se√ß√£o de not√≠cias
            if (!window.authManager.hasPermission('manage_news')) {
                const newsButton = document.querySelector('a[href="/admin-panel.html"]');
                if (newsButton) {
                    newsButton.style.display = 'none';
                }
            }
        }

        // Carregar estat√≠sticas atuais (do Supabase)
        async function loadCurrentStats() {
            const currentStatsClientsDiv = document.getElementById('currentStatsClients');
            const currentStatsPersonalDiv = document.getElementById('currentStatsPersonal');
            
            // Verificar se os elementos existem antes de usar
            if (!currentStatsClientsDiv || !currentStatsPersonalDiv) {
                console.warn('‚ö†Ô∏è Elementos de estat√≠sticas n√£o encontrados no DOM');
                return;
            }
            
            const defaultStats = {
                'gestores-treinados': '+300',
                'nps-clientes': '9,6',
                'redes-parceiras': '3',
                'anos-experiencia': '20',
                'faturamento-anual': 'R$ 2bi',
                'pessoas-geridas': '150+',
                'inicio-mercado': '1998'
            };
            
            // Tentar carregar do Supabase
            let stats = {};
            if (window.SUPABASE_CONFIG) {
                try {
                    const supabaseClient = getSupabaseClientAnon();
                    if (!supabaseClient) {
                        console.warn('‚ö†Ô∏è Cliente Supabase n√£o dispon√≠vel');
                        return;
                    }
                    
                    const { data, error } = await supabaseClient
                        .from('site_stats')
                        .select('key, value');
                    
                    if (!error && data) {
                        data.forEach(row => {
                            stats[row.key] = row.value;
                        });
                    }
                } catch (error) {
                    console.error('Erro ao carregar estat√≠sticas do Supabase:', error);
                    // Fallback para localStorage
                    stats = JSON.parse(localStorage.getItem('temvenda_stats') || '{}');
                }
            } else {
                // Fallback para localStorage se Supabase n√£o dispon√≠vel
                stats = JSON.parse(localStorage.getItem('temvenda_stats') || '{}');
            }
            
            const finalStats = { ...defaultStats, ...stats };
            
            if (currentStatsClientsDiv) {
            currentStatsClientsDiv.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${finalStats['gestores-treinados']}</div>
                    <div class="stat-label">Gestores Treinados</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${finalStats['nps-clientes']}</div>
                    <div class="stat-label">NPS dos Clientes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${finalStats['redes-parceiras']}</div>
                    <div class="stat-label">Redes Parceiras</div>
                </div>
            `;
            }
            
            if (currentStatsPersonalDiv) {
            currentStatsPersonalDiv.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${finalStats['anos-experiencia']}</div>
                    <div class="stat-label">Anos de Experi√™ncia</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${finalStats['faturamento-anual']}</div>
                    <div class="stat-label">Faturamento Anual</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${finalStats['pessoas-geridas']}</div>
                    <div class="stat-label">Pessoas Geridas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${finalStats['inicio-mercado']}</div>
                    <div class="stat-label">In√≠cio no Mercado</div>
                </div>
            `;
            }
        }

        // Salvar estat√≠sticas (no Supabase)
        const statsForm = document.getElementById('statsForm');
        if (!statsForm) {
            console.error('‚ùå Formul√°rio statsForm n√£o encontrado no DOM');
        } else {
        statsForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const stats = {
                'gestores-treinados': formData.get('gestores-treinados'),
                'nps-clientes': formData.get('nps-clientes'),
                'redes-parceiras': formData.get('redes-parceiras'),
                'anos-experiencia': formData.get('anos-experiencia'),
                'faturamento-anual': formData.get('faturamento-anual'),
                'pessoas-geridas': formData.get('pessoas-geridas'),
                'inicio-mercado': formData.get('inicio-mercado')
            };
            
            // Salvar no Supabase
            if (window.SUPABASE_CONFIG) {
                try {
                    const supabaseClient = getSupabaseClientAnon();
                    if (!supabaseClient) {
                        console.warn('‚ö†Ô∏è Cliente Supabase n√£o dispon√≠vel');
                        return;
                    }
                    
                    // Preparar upserts (insert ou update)
                    const upserts = Object.entries(stats).map(([key, value]) => ({
                        key: key,
                        value: value
                    }));
                    
                    // Fazer upsert de cada estat√≠stica
                    for (const item of upserts) {
                        const { error } = await supabaseClient
                            .from('site_stats')
                            .upsert(item, { onConflict: 'key' });
                        
                        if (error) {
                            console.error(`Erro ao salvar ${item.key}:`, error);
                        }
                    }
                    
                    // Tamb√©m salvar no localStorage como fallback
            localStorage.setItem('temvenda_stats', JSON.stringify(stats));
            
            // Mostrar mensagem de sucesso
            const successMessage = document.getElementById('successMessage');
                    if (successMessage) {
            successMessage.style.display = 'block';
                        successMessage.textContent = '‚úÖ Estat√≠sticas salvas com sucesso no banco de dados!';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
                    }
                    
                } catch (error) {
                    console.error('Erro ao salvar no Supabase:', error);
                    // Fallback para localStorage
                    localStorage.setItem('temvenda_stats', JSON.stringify(stats));
                    
                    const successMessage = document.getElementById('successMessage');
                    if (successMessage) {
                        successMessage.style.display = 'block';
                        successMessage.textContent = '‚ö†Ô∏è Salvo localmente (erro ao conectar com banco)';
                        setTimeout(() => {
                            successMessage.style.display = 'none';
                        }, 3000);
                    }
                }
            } else {
                // Fallback para localStorage se Supabase n√£o dispon√≠vel
                localStorage.setItem('temvenda_stats', JSON.stringify(stats));
                
                const successMessage = document.getElementById('successMessage');
                if (successMessage) {
                    successMessage.style.display = 'block';
                    successMessage.textContent = '‚ö†Ô∏è Salvo localmente (Supabase n√£o configurado)';
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
            }
            
            // Recarregar estat√≠sticas atuais
            await loadCurrentStats();
            
            // Atualizar n√∫mero de logos se redes-parceiras mudou
            if (stats['redes-parceiras']) {
                updateLogosUpload();
            }
            
            // N√£o limpar formul√°rio (manter valores)
        });
        }

        // Carregar estat√≠sticas salvas no formul√°rio (do Supabase)
        async function loadStatsToForm() {
            let stats = {};
            
            // Tentar carregar do Supabase
            if (window.SUPABASE_CONFIG) {
                try {
                    const supabaseClient = getSupabaseClientAnon();
                    if (!supabaseClient) {
                        console.warn('‚ö†Ô∏è Cliente Supabase n√£o dispon√≠vel');
                        return;
                    }
                    
                    const { data, error } = await supabaseClient
                        .from('site_stats')
                        .select('key, value');
                    
                    if (!error && data) {
                        data.forEach(row => {
                            stats[row.key] = row.value;
                        });
                    }
                } catch (error) {
                    console.error('Erro ao carregar do Supabase:', error);
                    // Fallback para localStorage
                    stats = JSON.parse(localStorage.getItem('temvenda_stats') || '{}');
                }
            } else {
                // Fallback para localStorage
                stats = JSON.parse(localStorage.getItem('temvenda_stats') || '{}');
            }
            
            const gestoresEl = document.getElementById('gestores-treinados');
            const npsEl = document.getElementById('nps-clientes');
            const redesEl = document.getElementById('redes-parceiras');
            const anosEl = document.getElementById('anos-experiencia');
            const faturamentoEl = document.getElementById('faturamento-anual');
            const pessoasEl = document.getElementById('pessoas-geridas');
            const inicioEl = document.getElementById('inicio-mercado');
            
            if (stats['gestores-treinados'] && gestoresEl) gestoresEl.value = stats['gestores-treinados'];
            if (stats['nps-clientes'] && npsEl) npsEl.value = stats['nps-clientes'];
            if (stats['redes-parceiras'] && redesEl) {
                redesEl.value = stats['redes-parceiras'];
                updateLogosUpload();
            }
            if (stats['anos-experiencia'] && anosEl) anosEl.value = stats['anos-experiencia'];
            if (stats['faturamento-anual'] && faturamentoEl) faturamentoEl.value = stats['faturamento-anual'];
            if (stats['pessoas-geridas'] && pessoasEl) pessoasEl.value = stats['pessoas-geridas'];
            if (stats['inicio-mercado'] && inicioEl) inicioEl.value = stats['inicio-mercado'];
        }

        // Gerenciamento de logos de clientes
        let logoInputs = [];

        function updateLogosUpload() {
            console.log('üîÑ Atualizando inputs de upload de logos...');
            const redesInput = document.getElementById('redes-parceiras');
            if (!redesInput) {
                console.warn('‚ö†Ô∏è Input redes-parceiras n√£o encontrado');
                return;
            }
            const numClientes = parseInt(redesInput.value) || 0;
            console.log(`üìä N√∫mero de clientes parceiros: ${numClientes}`);
            
            const container = document.getElementById('logosUploadContainer');
            if (!container) {
                console.error('‚ùå Container #logosUploadContainer n√£o encontrado');
                return;
            }

            console.log('üßπ Limpando container...');
            container.innerHTML = '';

            logoInputs = [];
            
            for (let i = 0; i < numClientes; i++) {
                const logoDiv = document.createElement('div');
                logoDiv.style.display = 'flex';
                logoDiv.style.alignItems = 'center';
                logoDiv.style.gap = '12px';
                logoDiv.style.marginBottom = '8px';
                
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.style.width = '100%';
                input.style.padding = '6px';
                input.style.fontSize = '12px';
                input.style.border = '1px solid var(--tv-gray-border)';
                input.style.borderRadius = '4px';
                input.id = `logo-upload-${i}`;
                
                const preview = document.createElement('img');
                preview.id = `logo-preview-${i}`;
                preview.style.maxWidth = '60px';
                preview.style.maxHeight = '40px';
                preview.style.objectFit = 'contain';
                preview.style.display = 'none';
                preview.style.border = '1px solid var(--tv-gray-border)';
                preview.style.borderRadius = '4px';
                preview.style.padding = '4px';
                
                const removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.textContent = '√ó';
                removeBtn.style.display = 'none';
                removeBtn.style.width = '24px';
                removeBtn.style.height = '24px';
                removeBtn.style.background = 'var(--tv-danger)';
                removeBtn.style.color = 'white';
                removeBtn.style.border = 'none';
                removeBtn.style.borderRadius = '50%';
                removeBtn.style.cursor = 'pointer';
                removeBtn.style.fontSize = '16px';
                removeBtn.style.lineHeight = '1';
                removeBtn.onclick = () => removeLogo(i);

                input.addEventListener('change', (e) => handleLogoUpload(i, e.target.files[0], preview, removeBtn));
                
                logoDiv.appendChild(input);
                logoDiv.appendChild(preview);
                logoDiv.appendChild(removeBtn);
                
                container.appendChild(logoDiv);
                logoInputs.push({ input, preview, removeBtn });
            }

            // Carregar logos existentes
            loadExistingLogos();
            
            console.log(`‚úÖ ${logoInputs.length} inputs de upload criados`);
        }

        async function handleLogoUpload(index, file, preview, removeBtn) {
            if (!file) return;

            // Valida√ß√£o de tipo de arquivo
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml'];
            if (!validTypes.includes(file.type)) {
                alert('Tipo de arquivo inv√°lido. Use apenas imagens (JPG, PNG, GIF, WEBP ou SVG).');
                return;
            }

            // Valida√ß√£o de tamanho (m√°ximo 5MB antes da compress√£o)
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                alert('Arquivo muito grande. Use imagens menores que 5MB.');
                return;
            }

            if (!window.SUPABASE_CONFIG || !window.SUPABASE_CONFIG.serviceKey) {
                alert('Configura√ß√£o do Supabase n√£o encontrada. Verifique se a chave service_key est√° configurada.');
                return;
            }

            // Mostrar loading
            preview.style.display = 'block';
            preview.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="60" height="40"%3E%3Crect width="60" height="40" fill="%23f0f0f0"/%3E%3Ctext x="30" y="20" font-size="10" text-anchor="middle" dy=".35em" fill="%23999"%3EUploading...%3C/text%3E%3C/svg%3E';
            removeBtn.style.display = 'none';

            try {
                // Comprimir imagem
                const compressedFile = await compressImage(file, file.name);
                
                // Obter extens√£o do arquivo original
                const fileExtension = file.name.split('.').pop().toLowerCase();
                // Se for SVG, manter como PNG ap√≥s compress√£o
                const finalExtension = fileExtension === 'svg' ? 'png' : fileExtension === 'jpg' ? 'jpeg' : fileExtension;
                
                // Criar nome √∫nico
                const fileName = `logo-${Date.now()}-${index}.${finalExtension}`;
                
                // Upload para Supabase Storage usando serviceKey
                const supabaseStorageClient = getSupabaseClientService();
                if (!supabaseStorageClient) {
                    alert('Configura√ß√£o do Supabase n√£o encontrada. Verifique se a chave service_key est√° configurada.');
                    return;
                }

                console.log('Fazendo upload da logo:', fileName, 'Tamanho:', compressedFile.size, 'bytes');

                // Verificar se j√° existe um arquivo para este √≠ndice e remover antes
                let logos = JSON.parse(localStorage.getItem('temvenda_client_logos') || '[]');
                if (logos[index] && logos[index].fileName) {
                    try {
                        await supabaseStorageClient
                            .storage
                            .from('client-logos')
                            .remove([logos[index].fileName]);
                        console.log('üóëÔ∏è Logo anterior removida:', logos[index].fileName);
                    } catch (removeError) {
                        console.warn('‚ö†Ô∏è Erro ao remover logo anterior (pode n√£o existir):', removeError);
                    }
                }

                const { data, error: uploadError } = await supabaseStorageClient
                    .storage
                    .from('client-logos')
                    .upload(fileName, compressedFile, {
                        upsert: true, // Permite sobrescrever se existir
                        contentType: compressedFile.type || `image/${finalExtension}`
                    });

                if (uploadError) {
                    console.error('Erro do Supabase:', uploadError);
                    let errorMessage = 'Erro ao fazer upload da logo. ';
                    
                    if (uploadError.message.includes('Bucket not found') || uploadError.message.includes('bucket')) {
                        // Tentar criar o bucket automaticamente
                        const bucketCreated = await ensureBucketExists();
                        if (!bucketCreated) {
                            errorMessage += '\n\n‚ö†Ô∏è Bucket "client-logos" n√£o encontrado.\n\nüìã Crie manualmente no Supabase:\n1. Acesse Storage no painel do Supabase\n2. Clique em "New bucket"\n3. Nome: "client-logos"\n4. Marque como P√∫blico (Public bucket)\n5. Salve e tente novamente';
                        } else {
                            // Se o bucket foi criado, tentar novamente o upload
                            errorMessage += 'Bucket criado! Recarregue a p√°gina e tente novamente.';
                        }
                    } else if (uploadError.message.includes('new row violates row-level security')) {
                        errorMessage += 'Erro de permiss√£o. Verifique as pol√≠ticas do bucket no Supabase.';
                    } else if (uploadError.message.includes('duplicate')) {
                        errorMessage += 'Arquivo j√° existe. Tente novamente.';
                    } else {
                        errorMessage += uploadError.message || 'Verifique o console para mais detalhes.';
                    }
                    
                    throw new Error(errorMessage);
                }

                // Criar URL p√∫blica
                const { data: urlData } = supabaseStorageClient
                    .storage
                    .from('client-logos')
                    .getPublicUrl(fileName);

                const publicUrl = urlData?.publicUrl || `${window.SUPABASE_CONFIG.url}/storage/v1/object/public/client-logos/${fileName}`;
                
                preview.src = publicUrl;
                preview.style.display = 'block';
                removeBtn.style.display = 'block';

                // Salvar refer√™ncia no localStorage (reutilizar vari√°vel logos j√° declarada)
                logos[index] = { url: publicUrl, fileName };
                localStorage.setItem('temvenda_client_logos', JSON.stringify(logos));

                console.log('Logo enviada com sucesso:', publicUrl);

            } catch (error) {
                console.error('Erro ao fazer upload da logo:', error);
                
                // Esconder preview em caso de erro
                preview.style.display = 'none';
                removeBtn.style.display = 'none';
                
                alert(error.message || 'Erro ao fazer upload da logo. Verifique o console para mais detalhes.');
            }
        }

        async function loadExistingLogos() {
            try {
                if (!window.SUPABASE_CONFIG) return;

                // Usar inst√¢ncia √∫nica do cliente
                let supabaseClient = getSupabaseClientAnon();

                let files = [];
                let error = null;

                let listResult = await supabaseClient
                    .storage
                    .from('client-logos')
                    .list('', { limit: 100 });

                files = listResult.data;
                error = listResult.error;

                    // Se falhar e tiver serviceKey, tentar com serviceKey
                    if (error && window.SUPABASE_CONFIG.serviceKey) {
                        console.warn('‚ö†Ô∏è Erro ao listar com anonKey, tentando com serviceKey...');
                        supabaseClient = getSupabaseClientService();
                        if (!supabaseClient) {
                            console.error('‚ùå Cliente serviceKey n√£o dispon√≠vel');
                            return;
                        }
                    listResult = await supabaseClient
                        .storage
                        .from('client-logos')
                        .list('', { limit: 100 });
                    files = listResult.data;
                    error = listResult.error;
                }

                if (error) {
                    console.warn('Erro ao carregar logos:', error);
                    return;
                }

                if (!files || files.length === 0) {
                    console.log('Nenhuma logo encontrada para carregar');
                    return;
                }

                console.log(`üìÅ ${files.length} arquivos encontrados no bucket`);

                // Filtrar apenas logos por √≠ndice (uma por √≠ndice)
                // Ordenar por data de modifica√ß√£o (mais recente primeiro) para pegar as √∫ltimas
                files.sort((a, b) => new Date(b.updated_at || b.created_at || 0) - new Date(a.updated_at || a.created_at || 0));
                
                // Agrupar por prefixo (logo-timestamp-index) para pegar apenas a mais recente de cada √≠ndice
                const logosByIndex = {};
                files.forEach(file => {
                    const match = file.name.match(/logo-\d+-(\d+)\./);
                    if (match) {
                        const idx = parseInt(match[1]);
                        if (!logosByIndex[idx] || new Date(file.updated_at || file.created_at || 0) > new Date(logosByIndex[idx].updated_at || logosByIndex[idx].created_at || 0)) {
                            logosByIndex[idx] = file;
                        }
                    }
                });

                // Carregar apenas a logo mais recente de cada √≠ndice
                Object.keys(logosByIndex).forEach(indexStr => {
                    const index = parseInt(indexStr);
                    if (index < logoInputs.length) {
                        const file = logosByIndex[index];
                        const { data: urlData } = supabaseClient
                            .storage
                            .from('client-logos')
                            .getPublicUrl(file.name);
                        
                        if (urlData?.publicUrl) {
                            logoInputs[index].preview.src = urlData.publicUrl;
                            logoInputs[index].preview.style.display = 'block';
                            logoInputs[index].removeBtn.style.display = 'block';
                            
                            // Atualizar localStorage com a logo mais recente
                            const logos = JSON.parse(localStorage.getItem('temvenda_client_logos') || '[]');
                            logos[index] = { url: urlData.publicUrl, fileName: file.name };
                            localStorage.setItem('temvenda_client_logos', JSON.stringify(logos));
                        }
                    }
                });

                console.log(`‚úÖ ${Object.keys(logosByIndex).length} logos carregadas nos previews (removendo duplicatas)`);

            } catch (error) {
                console.error('Erro ao carregar logos existentes:', error);
            }
        }

        async function removeLogo(index) {
            try {
                if (!window.SUPABASE_CONFIG || !window.SUPABASE_CONFIG.serviceKey) return;

                // Buscar nome do arquivo
                let logos = JSON.parse(localStorage.getItem('temvenda_client_logos') || '[]');
                const logo = logos[index];

                if (logo && logo.fileName) {
                    // Deletar do storage usando SDK
                    const supabaseStorageClient = getSupabaseClientService();
                    if (!supabaseStorageClient) {
                        console.error('‚ùå Cliente serviceKey n√£o dispon√≠vel');
                        return;
                    }

                    await supabaseStorageClient
                        .storage
                        .from('client-logos')
                        .remove([logo.fileName]);
                }

                // Remover do localStorage
                logos[index] = null;
                localStorage.setItem('temvenda_client_logos', JSON.stringify(logos));

                // Limpar preview
                logoInputs[index].preview.src = '';
                logoInputs[index].preview.style.display = 'none';
                logoInputs[index].removeBtn.style.display = 'none';
                logoInputs[index].input.value = '';

            } catch (error) {
                console.error('Erro ao remover logo:', error);
            }
        }

        async function compressImage(file, originalName) {
            return new Promise((resolve, reject) => {
                // Se for SVG, tentar converter
                if (file.type === 'image/svg+xml') {
                    // Para SVG, vamos manter como est√° por enquanto ou converter
                    // Vamos converter SVG para PNG
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            const maxWidth = 400;
                            const maxHeight = 200;
                            let width = img.width || 400;
                            let height = img.height || 200;

                            // Manter propor√ß√£o
                            if (width > height) {
                                if (width > maxWidth) {
                                    height = (height * maxWidth) / width;
                                    width = maxWidth;
                                }
                            } else {
                                if (height > maxHeight) {
                                    width = (width * maxHeight) / height;
                                    height = maxHeight;
                                }
                            }

                            canvas.width = width;
                            canvas.height = height;

                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);

                            canvas.toBlob((blob) => {
                                if (blob) {
                                    blob.name = originalName;
                                    blob.type = 'image/png';
                                    resolve(blob);
                                } else {
                                    reject(new Error('Erro ao comprimir imagem SVG'));
                                }
                            }, 'image/png', 0.9);
                        };
                        img.onerror = () => {
                            reject(new Error('Erro ao carregar imagem SVG'));
                        };
                        img.src = e.target.result;
                    };
                    reader.onerror = () => {
                        reject(new Error('Erro ao ler arquivo SVG'));
                    };
                    reader.readAsDataURL(file);
                    return;
                }

                // Para outros formatos
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        // Tamanho m√°ximo otimizado para logos (largura m√°xima 400px, altura m√°xima 200px)
                        const maxWidth = 400;
                        const maxHeight = 200;
                        let width = img.width;
                        let height = img.height;

                        // Manter propor√ß√£o
                        const aspectRatio = width / height;
                        
                        if (width > height) {
                            if (width > maxWidth) {
                                width = maxWidth;
                                height = width / aspectRatio;
                            }
                        } else {
                            if (height > maxHeight) {
                                height = maxHeight;
                                width = height * aspectRatio;
                            }
                        }

                        // Garantir dimens√µes m√≠nimas razo√°veis
                        if (width < 50) width = 50;
                        if (height < 30) height = 30;

                        canvas.width = width;
                        canvas.height = height;

                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        // Usar o tipo original se poss√≠vel, sen√£o JPEG
                        const outputType = file.type === 'image/png' ? 'image/png' : 'image/jpeg';
                        const quality = file.type === 'image/png' ? 0.9 : 0.85;

                        canvas.toBlob((blob) => {
                            if (blob) {
                                blob.name = originalName;
                                blob.type = outputType;
                                console.log('Imagem comprimida:', {
                                    original: file.size,
                                    compressed: blob.size,
                                    reduction: ((1 - blob.size / file.size) * 100).toFixed(1) + '%',
                                    dimensions: `${width}x${height}`
                                });
                                resolve(blob);
                            } else {
                                reject(new Error('Erro ao comprimir imagem'));
                            }
                        }, outputType, quality);
                    };
                    img.onerror = () => {
                        reject(new Error('Erro ao carregar imagem'));
                    };
                    img.src = e.target.result;
                };
                reader.onerror = () => {
                    reject(new Error('Erro ao ler arquivo'));
                };
                reader.readAsDataURL(file);
            });
        }

        // Criar bucket automaticamente se n√£o existir
        async function ensureBucketExists() {
            try {
                if (!window.SUPABASE_CONFIG || !window.SUPABASE_CONFIG.serviceKey) {
                    console.warn('Supabase config n√£o encontrada');
                    return false;
                }

                const supabaseStorageClient = getSupabaseClientService();
                if (!supabaseStorageClient) {
                    console.warn('‚ö†Ô∏è Cliente serviceKey n√£o dispon√≠vel');
                    return false;
                }

                // Verificar se o bucket existe
                const { data: buckets, error: listError } = await supabaseStorageClient
                    .storage
                    .listBuckets();

                if (listError) {
                    console.warn('Erro ao listar buckets:', listError);
                    return false;
                }

                const bucketExists = buckets && buckets.some(b => b.id === 'client-logos');

                if (!bucketExists) {
                    console.log('Bucket "client-logos" n√£o encontrado. Tentando criar...');
                    
                    // Tentar criar o bucket
                    const { data: newBucket, error: createError } = await supabaseStorageClient
                        .storage
                        .createBucket('client-logos', {
                            public: true,
                            fileSizeLimit: 5242880, // 5MB
                            allowedMimeTypes: ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml']
                        });

                    if (createError) {
                        console.error('Erro ao criar bucket:', createError);
                        // N√£o √© poss√≠vel criar via API em alguns casos
                        alert('‚ö†Ô∏è Bucket "client-logos" n√£o encontrado.\n\nPor favor, crie manualmente no Supabase:\n1. Acesse Storage no painel do Supabase\n2. Clique em "New bucket"\n3. Nome: "client-logos"\n4. Marque como P√∫blico (Public bucket)\n5. Salve e tente novamente');
                        return false;
                    }

                    console.log('‚úÖ Bucket "client-logos" criado com sucesso!');
                    return true;
                }

                console.log('‚úÖ Bucket "client-logos" j√° existe');
                return true;
            } catch (error) {
                console.error('Erro ao verificar/criar bucket:', error);
                return false;
            }
        }

        // Listener para mudan√ßa no n√∫mero de clientes
        document.addEventListener('DOMContentLoaded', function() {
            // Tentar criar bucket automaticamente ao carregar
            setTimeout(() => {
                ensureBucketExists();
            }, 1000);

            const redesInput = document.getElementById('redes-parceiras');
            if (redesInput) {
                redesInput.addEventListener('change', updateLogosUpload);
                redesInput.addEventListener('input', updateLogosUpload);
            }

            const addLogoBtn = document.getElementById('addLogoBtn');
            if (addLogoBtn) {
                console.log('‚úÖ Bot√£o "Adicionar Logo" encontrado, adicionando listener...');
                addLogoBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('üñ±Ô∏è Bot√£o "Adicionar Logo" clicado!');
                    
                    const redesInput = document.getElementById('redes-parceiras');
                    if (!redesInput) {
                        console.error('‚ùå Input redes-parceiras n√£o encontrado');
                        return;
                    }
                    
                    const numClientes = parseInt(redesInput.value) || 0;
                    const novoValor = numClientes + 1;
                    console.log(`‚ûï Aumentando de ${numClientes} para ${novoValor} clientes`);
                    
                    redesInput.value = novoValor;
                    redesInput.dispatchEvent(new Event('change', { bubbles: true }));
                    
                    // Atualizar tamb√©m o localStorage
            const stats = JSON.parse(localStorage.getItem('temvenda_stats') || '{}');
                    stats['redes-parceiras'] = novoValor.toString();
                    localStorage.setItem('temvenda_stats', JSON.stringify(stats));
                    
                    updateLogosUpload();
                });
            } else {
                console.error('‚ùå Bot√£o "Adicionar Logo" n√£o encontrado!');
            }

            // Inicializar se j√° houver valor
            loadStatsToForm();
        });

        // Fun√ß√µes para gerenciar imagens
        function loadImages() {
            const images = JSON.parse(localStorage.getItem('temvenda_images') || '{}');
            
            Object.keys(images).forEach(imageKey => {
                const preview = document.getElementById(`preview-${imageKey}`);
                if (preview && images[imageKey]) {
                    preview.innerHTML = `<img src="${images[imageKey]}" alt="${imageKey}">`;
                    const removeBtn = preview.parentElement.querySelector('.remove-btn');
                    if (removeBtn) removeBtn.style.display = 'inline-block';
                }
            });
        }

        function saveImage(imageKey, imageData) {
            const images = JSON.parse(localStorage.getItem('temvenda_images') || '{}');
            images[imageKey] = imageData;
            try {
                localStorage.setItem('temvenda_images', JSON.stringify(images));
            } catch (e) {
                alert('A imagem √© muito grande para salvar. Tente uma imagem menor ou mais comprimida.');
                // Reverte a inclus√£o para n√£o manter em mem√≥ria
                delete images[imageKey];
                try { localStorage.setItem('temvenda_images', JSON.stringify(images)); } catch(_e){}
                throw e;
            }
        }

        function removeImage(imageKey) {
            const images = JSON.parse(localStorage.getItem('temvenda_images') || '{}');
            delete images[imageKey];
            localStorage.setItem('temvenda_images', JSON.stringify(images));
            
            const preview = document.getElementById(`preview-${imageKey}`);
            if (preview) {
                preview.innerHTML = '<div class="placeholder">Nenhuma imagem selecionada</div>';
            
                const removeBtn = preview.parentElement?.querySelector('.remove-btn');
            if (removeBtn) removeBtn.style.display = 'none';
            }
        }

        function handleImageUpload(file, imageKey) {
            if (!file || !file.type.startsWith('image/')) {
                alert('Por favor, selecione um arquivo de imagem v√°lido.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const srcData = e.target.result;
                // Comprimir em canvas para reduzir tamanho (limite ~5MB do localStorage)
                const img = new Image();
                img.onload = function(){
                    const maxW = 1600, maxH = 1200;
                    let { width, height } = img;
                    const ratio = Math.min(maxW/width, maxH/height, 1);
                    const canvas = document.createElement('canvas');
                    canvas.width = Math.round(width * ratio);
                    canvas.height = Math.round(height * ratio);
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    let imageData;
                    try {
                        imageData = canvas.toDataURL('image/jpeg', 0.85);
                    } catch(_e){
                        imageData = srcData; // fallback
                    }

                    try {
                        saveImage(imageKey, imageData);
                    } catch(_quota){
                        return; // mensagem j√° exibida em saveImage
                    }

                    const preview = document.getElementById(`preview-${imageKey}`);
                    if (preview) {
                        preview.innerHTML = `<img src="${imageData}" alt="${imageKey}">`;
                    }
                    const removeBtn = preview.parentElement.querySelector('.remove-btn');
                    if (removeBtn) removeBtn.style.display = 'inline-block';
                };
                img.onerror = function(){
                    alert('N√£o foi poss√≠vel processar a imagem selecionada.');
                };
                img.src = srcData;
            };
            reader.readAsDataURL(file);
        }

        function confirmSave(imageKey){
            const preview = document.getElementById(`preview-${imageKey}`);
            if (!preview) return;
            const img = preview.querySelector('img');
            if (!img || !img.src) { alert('Selecione uma imagem antes de salvar.'); return; }
            saveImage(imageKey, img.src);
            const msg = document.getElementById('successMessage');
            if (msg){
                msg.textContent = '‚úÖ Imagem salva com sucesso!';
                msg.style.display = 'block';
                setTimeout(()=>{ msg.style.display = 'none'; msg.textContent = '‚úÖ Estat√≠sticas atualizadas com sucesso!'; }, 2000);
            }
        }

        // Configurar eventos de upload
        function setupImageUploads() {
            const imageKeys = ['formacao-lider', 'formacao-cesar', 'palestras-hero', 'palestras-cesar', 'treinamento-hero'];
            
            imageKeys.forEach(imageKey => {
                const fileInput = document.getElementById(`file-${imageKey}`);
                if (fileInput) {
                    fileInput.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            handleImageUpload(file, imageKey);
                        }
                    });
                }
            });
        }

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOMContentLoaded - Iniciando carregamento...');
            
            // Garantir que os bot√µes est√£o vis√≠veis desde o in√≠cio
            const downloadBtn = document.getElementById('btn-download-pdf');
            const refreshBtn = document.getElementById('btn-refresh-pdf');
            
            if (downloadBtn) {
                downloadBtn.style.display = 'inline-block';
                console.log('‚úÖ Bot√£o de download encontrado e tornado vis√≠vel');
            } else {
                console.error('‚ùå Bot√£o btn-download-pdf N√ÉO encontrado no DOM!');
            }
            
            if (refreshBtn) {
                refreshBtn.style.display = 'inline-block';
                console.log('‚úÖ Bot√£o de refresh encontrado e tornado vis√≠vel');
            } else {
                console.error('‚ùå Bot√£o btn-refresh-pdf N√ÉO encontrado no DOM!');
            }
            
            // Verificar se elementos cr√≠ticos existem
            const preview = document.getElementById('preview-pdf');
            if (!preview) {
                console.error('‚ùå Elemento preview-pdf N√ÉO encontrado no DOM!');
            }
            
            // Carregar fun√ß√µes ass√≠ncronas
            loadCurrentStats();
            loadStatsToForm();
            loadImages();
            setupImageUploads();
            loadInstagramConfig();
            
            // Carregar preview do PDF com timeout para garantir execu√ß√£o
            setTimeout(() => {
            loadPdfPreview();
            }, 500);
        });
        
        // Fallback: Se DOMContentLoaded j√° passou, executar imediatamente
        if (document.readyState === 'loading') {
            // DOM ainda est√° carregando, aguardar DOMContentLoaded
            console.log('‚è≥ DOM ainda carregando, aguardando...');
        } else {
            // DOM j√° carregou, executar imediatamente
            console.log('‚úÖ DOM j√° carregado, executando inicializa√ß√£o imediata...');
            const downloadBtn = document.getElementById('btn-download-pdf');
            const refreshBtn = document.getElementById('btn-refresh-pdf');
            
            if (downloadBtn) {
                downloadBtn.style.display = 'inline-block';
                console.log('‚úÖ [FALLBACK] Bot√£o de download tornado vis√≠vel');
            }
            
            if (refreshBtn) {
                refreshBtn.style.display = 'inline-block';
                console.log('‚úÖ [FALLBACK] Bot√£o de refresh tornado vis√≠vel');
            }
        }

        // Fun√ß√µes para gerenciar p√°gina de captura Instagram
        async function loadInstagramConfig() {
            console.log('üîç loadInstagramConfig() iniciado...');
            
            // Fun√ß√£o auxiliar para preencher campo com seguran√ßa
            function fillField(id, value) {
                const element = document.getElementById(id);
                if (element) {
                    element.value = value || '';
                    console.log(`‚úÖ Campo ${id} preenchido:`, value || '(vazio)');
                } else {
                    console.warn(`‚ö†Ô∏è Elemento ${id} n√£o encontrado no DOM`);
                }
            }
            
            try {
                // Verificar se os elementos existem no DOM
                const requiredElements = [
                    'instagram-main-title',
                    'instagram-main-subtitle',
                    'instagram-benefit-1',
                    'instagram-benefit-2',
                    'instagram-benefit-3',
                    'instagram-benefit-4',
                    'instagram-button-text'
                ];
                
                const missingElements = requiredElements.filter(id => !document.getElementById(id));
                if (missingElements.length > 0) {
                    console.warn('‚ö†Ô∏è Elementos n√£o encontrados no DOM:', missingElements);
                    console.log('üîÑ Tentando novamente em 500ms...');
                    setTimeout(loadInstagramConfig, 500);
                    return;
                }
                
                console.log('‚úÖ Todos os elementos encontrados no DOM');
                
                const client = getSupabaseClientService();
                if (!client) {
                    console.warn('‚ö†Ô∏è Cliente serviceKey n√£o dispon√≠vel, usando localStorage');
                    // Fallback para localStorage
                    const config = JSON.parse(localStorage.getItem('instagram_config') || '{}');
                    fillField('instagram-main-title', config.mainTitle || '');
                    fillField('instagram-main-subtitle', config.mainSubtitle || '');
                    fillField('instagram-benefit-1', config.benefit1 || '');
                    fillField('instagram-benefit-2', config.benefit2 || '');
                    fillField('instagram-benefit-3', config.benefit3 || '');
                    fillField('instagram-benefit-4', config.benefit4 || '');
                    fillField('instagram-button-text', config.buttonText || '');
                    return;
                }
                
                console.log('üì° Buscando configura√ß√£o no banco de dados via REST API...');
                
                // Usar fetch direto (REST API) com serviceKey para garantir acesso
                const supabaseUrl = window.SUPABASE_CONFIG.url;
                const supabaseServiceKey = window.SUPABASE_CONFIG.serviceKey;
                
                if (!supabaseServiceKey) {
                    console.warn('‚ö†Ô∏è serviceKey n√£o encontrada, usando SDK');
                    // Fallback para SDK
                const { data, error } = await client
                    .from('instagram_capture_config')
                    .select('*')
                    .order('updated_at', { ascending: false })
                    .limit(1)
                    .maybeSingle();
                    
                    if (error) {
                        console.error('‚ùå Erro ao buscar configura√ß√£o:', error);
                        throw error;
                    }
                    
                    console.log('üìã Dados recebidos do banco (SDK):', data);
                    var data = data;
                } else {
                    // REST API direta
                    const response = await fetch(
                        `${supabaseUrl}/rest/v1/instagram_capture_config?select=*&order=updated_at.desc&limit=1`,
                        {
                            headers: {
                                'apikey': supabaseServiceKey,
                                'Authorization': `Bearer ${supabaseServiceKey}`,
                                'Content-Type': 'application/json'
                            }
                        }
                    );
                    
                    console.log('üì° Status da resposta REST:', response.status, response.statusText);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('‚ùå Erro HTTP ao buscar configura√ß√£o:', response.status, errorText);
                        throw new Error(`HTTP ${response.status}: ${errorText}`);
                    }
                    
                    const dataArray = await response.json();
                    console.log('üìã Dados recebidos do banco (REST):', dataArray);
                    
                    var data = (dataArray && dataArray.length > 0) ? dataArray[0] : null;
                }
                
                console.log('üìã Dados finais a serem aplicados:', data);
                
                // Usar dados do banco ou fallback para localStorage
                const config = data || JSON.parse(localStorage.getItem('instagram_config') || '{}');
                
                console.log('üîß Configura√ß√£o a ser aplicada:', config);
                
                // Preencher campos usando a fun√ß√£o auxiliar
                fillField('instagram-main-title', config.main_title || config.mainTitle || '');
                fillField('instagram-main-subtitle', config.main_subtitle || config.mainSubtitle || '');
                fillField('instagram-benefit-1', config.benefit1 || '');
                fillField('instagram-benefit-2', config.benefit2 || '');
                fillField('instagram-benefit-3', config.benefit3 || '');
                fillField('instagram-benefit-4', config.benefit4 || '');
                fillField('instagram-button-text', config.button_text || config.buttonText || '');
                
                // Guardar como fallback local (usando valores finais dos campos)
                const savedConfig = {
                    mainTitle: document.getElementById('instagram-main-title')?.value || '',
                    mainSubtitle: document.getElementById('instagram-main-subtitle')?.value || '',
                    benefit1: document.getElementById('instagram-benefit-1')?.value || '',
                    benefit2: document.getElementById('instagram-benefit-2')?.value || '',
                    benefit3: document.getElementById('instagram-benefit-3')?.value || '',
                    benefit4: document.getElementById('instagram-benefit-4')?.value || '',
                    buttonText: document.getElementById('instagram-button-text')?.value || '',
                    pdf_url: (data && data.pdf_url) || ''
                };
                localStorage.setItem('instagram_config', JSON.stringify(savedConfig));
                console.log('üíæ Configura√ß√£o salva no localStorage:', savedConfig);
                
                console.log('‚úÖ Configura√ß√£o do Instagram carregada com sucesso!');
            } catch (e) {
                console.error('‚ùå Erro ao carregar configura√ß√£o do Instagram:', e);
                // Fallback para localStorage
                try {
                const config = JSON.parse(localStorage.getItem('instagram_config') || '{}');
                    console.log('üîÑ Usando fallback do localStorage:', config);
                    fillField('instagram-main-title', config.mainTitle || '');
                    fillField('instagram-main-subtitle', config.mainSubtitle || '');
                    fillField('instagram-benefit-1', config.benefit1 || '');
                    fillField('instagram-benefit-2', config.benefit2 || '');
                    fillField('instagram-benefit-3', config.benefit3 || '');
                    fillField('instagram-benefit-4', config.benefit4 || '');
                    fillField('instagram-button-text', config.buttonText || '');
                } catch (localStorageError) {
                    console.error('‚ùå Erro ao carregar do localStorage:', localStorageError);
                }
            }
        }

        async function saveInstagramConfig() {
            const payload = {
                main_title: document.getElementById('instagram-main-title').value.trim(),
                main_subtitle: document.getElementById('instagram-main-subtitle').value.trim(),
                benefit1: document.getElementById('instagram-benefit-1').value.trim(),
                benefit2: document.getElementById('instagram-benefit-2').value.trim(),
                benefit3: document.getElementById('instagram-benefit-3').value.trim(),
                benefit4: document.getElementById('instagram-benefit-4').value.trim(),
                button_text: document.getElementById('instagram-button-text').value.trim(),
                updated_at: new Date().toISOString()
            };
            
            // Listar altera√ß√µes para feedback
            const changes = [];
            if (payload.main_title) changes.push(`T√≠tulo: "${payload.main_title}"`);
            if (payload.main_subtitle) changes.push(`Subt√≠tulo: "${payload.main_subtitle}"`);
            if (payload.benefit1) changes.push(`Benef√≠cio 1: "${payload.benefit1}"`);
            if (payload.benefit2) changes.push(`Benef√≠cio 2: "${payload.benefit2}"`);
            if (payload.benefit3) changes.push(`Benef√≠cio 3: "${payload.benefit3}"`);
            if (payload.benefit4) changes.push(`Benef√≠cio 4: "${payload.benefit4}"`);
            if (payload.button_text) changes.push(`Bot√£o: "${payload.button_text}"`);
            
            // Salvar tamb√©m local como fallback
            localStorage.setItem('instagram_config', JSON.stringify({
                mainTitle: payload.main_title,
                mainSubtitle: payload.main_subtitle,
                benefit1: payload.benefit1,
                benefit2: payload.benefit2,
                benefit3: payload.benefit3,
                benefit4: payload.benefit4,
                buttonText: payload.button_text
            }));
            
            try {
                const client = getSupabaseClientService();
                if (!client) {
                    console.error('‚ùå Cliente serviceKey n√£o dispon√≠vel');
                    alert('Erro: Cliente Supabase n√£o configurado');
                    return;
                }
                
                // Buscar registro mais recente para manter pdf_url
                const { data: existing } = await client
                    .from('instagram_capture_config')
                    .select('pdf_url')
                    .order('updated_at', { ascending: false })
                    .limit(1)
                    .maybeSingle();
                
                // Se existe PDF salvo, manter no payload
                if (existing?.pdf_url) {
                    payload.pdf_url = existing.pdf_url;
                }
                
                // Usar upsert para evitar m√∫ltiplos registros (atualiza se existe, cria se n√£o existe)
                // Como n√£o temos ID √∫nico, vamos sempre inserir e depois deletar os antigos
                const { error: insertError } = await client.from('instagram_capture_config').insert(payload);
                if (insertError) throw insertError;
                
                // Limpar registros antigos (manter apenas os 5 mais recentes)
                const { data: allRecords } = await client
                    .from('instagram_capture_config')
                    .select('id')
                    .order('updated_at', { ascending: false });
                
                if (allRecords && allRecords.length > 5) {
                    const idsToDelete = allRecords.slice(5).map(r => r.id);
                    for (const id of idsToDelete) {
                        await client.from('instagram_capture_config').delete().eq('id', id);
                    }
                }
                
                // Recarregar configura√ß√µes e PDF ap√≥s salvar
                await loadInstagramConfig();
                await loadPdfPreview();
                
                // Mensagem de sucesso detalhada
                const successMsg = document.getElementById('successMessage');
            if (successMsg) {
                    let changesList = '';
                    if (changes.length > 0) {
                        changesList = '<br><br><strong style="display: block; margin-bottom: 8px;">‚úÖ Altera√ß√µes salvas:</strong><ul style="margin: 0; padding-left: 24px; list-style: disc;">' + 
                                     changes.map(c => `<li style="margin: 6px 0; line-height: 1.5;">${c}</li>`).join('') + 
                                     '</ul>';
                    } else {
                        changesList = '<br><br>‚úÖ Todas as configura√ß√µes foram salvas.';
                    }
                    successMsg.innerHTML = `<strong style="display: block; margin-bottom: 8px; font-size: 16px;">‚úÖ Configura√ß√µes salvas com sucesso!</strong>${changesList}`;
                successMsg.style.display = 'block';
                    successMsg.style.background = 'rgba(94,225,0,0.15)';
                    successMsg.style.borderColor = 'var(--tv-green)';
                    successMsg.style.color = 'var(--tv-black)';
                    console.log('‚úÖ Mensagem de sucesso exibida:', changes);
                    setTimeout(() => { 
                        successMsg.style.display = 'none';
                        successMsg.innerHTML = '‚úÖ Estat√≠sticas atualizadas com sucesso!';
                        successMsg.style.background = 'rgba(94,225,0,0.1)';
                    }, 8000);
                } else {
                    console.warn('‚ö†Ô∏è Elemento successMessage n√£o encontrado');
                    alert('‚úÖ Configura√ß√µes salvas!\n\n' + changes.map(c => `‚Ä¢ ${c}`).join('\n'));
                }
            } catch(e) {
                console.error('Erro ao salvar no Supabase:', e);
                const successMsg = document.getElementById('successMessage');
                if (successMsg) {
                    successMsg.innerHTML = `<strong>‚ö†Ô∏è Salvado localmente</strong><br>Erro ao salvar no servidor: ${e.message}<br>As altera√ß√µes foram salvas apenas no navegador.`;
                    successMsg.style.display = 'block';
                    successMsg.style.background = '#fff3cd';
                    successMsg.style.color = '#856404';
                    setTimeout(() => { 
                        successMsg.style.display = 'none';
                        successMsg.style.background = '#d4edda';
                        successMsg.style.color = '#155724';
                    }, 5000);
                }
            }
        }

        async function handlePdfUpload() {
            const fileInput = document.getElementById('file-pdf');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (file.type !== 'application/pdf') {
                alert('Por favor, selecione um arquivo PDF v√°lido.');
                return;
            }
            try {
                const client = getSupabaseClientService();
                if (!client) {
                    alert('Configura√ß√£o do Supabase n√£o encontrada. Verifique se a chave service_key est√° configurada.');
                    return;
                }
                // garantir bucket
                try {
                    const { data: buckets } = await client.storage.listBuckets();
                    const exists = (buckets||[]).some(b => b.name === 'landing-assets');
                    if (!exists) {
                        await client.storage.createBucket('landing-assets', { public: true });
                    }
                } catch(_e) {}
                const bucket = 'landing-assets';
                const path = `instagram/ebook.pdf`;
                const { error: upErr } = await client.storage.from(bucket).upload(path, file, { upsert: true, contentType: 'application/pdf' });
                if (upErr) {
                    alert('N√£o foi poss√≠vel enviar o PDF ao Storage. Detalhes: ' + (upErr.message || JSON.stringify(upErr)));
                    throw upErr;
                }
                const { data: pub } = client.storage.from(bucket).getPublicUrl(path);
                const pdfUrl = pub?.publicUrl || '';
                
                // Buscar registro mais recente para atualizar com PDF
                const { data: existing } = await client
                    .from('instagram_capture_config')
                    .select('*')
                    .order('updated_at', { ascending: false })
                    .limit(1)
                    .maybeSingle();
                
                // Se existe registro, atualizar com pdf_url. Se n√£o, criar novo apenas com pdf_url
                if (existing) {
                    // Criar novo registro com todos os dados existentes + novo pdf_url
                    const updatePayload = {
                        main_title: existing.main_title || '',
                        main_subtitle: existing.main_subtitle || '',
                        benefit1: existing.benefit1 || '',
                        benefit2: existing.benefit2 || '',
                        benefit3: existing.benefit3 || '',
                        benefit4: existing.benefit4 || '',
                        button_text: existing.button_text || '',
                        pdf_url: pdfUrl,
                        updated_at: new Date().toISOString()
                    };
                    await client.from('instagram_capture_config').insert(updatePayload);
                } else {
                    // Criar novo registro apenas com PDF
                    await client.from('instagram_capture_config').insert({ 
                        pdf_url: pdfUrl, 
                        updated_at: new Date().toISOString(),
                        main_title: 'E-book Gratuito',
                        main_subtitle: 'Descubra os segredos do sucesso empresarial'
                    });
                }
                
                // Recarregar preview do PDF
                await loadPdfPreview();
                
                // Feedback detalhado
                const msg = document.getElementById('successMessage');
                if (msg) {
                    msg.innerHTML = `<strong style="display: block; margin-bottom: 8px; font-size: 16px;">‚úÖ PDF enviado com sucesso!</strong><ul style="margin: 0; padding-left: 24px; list-style: disc;"><li style="margin: 6px 0;">üìÑ Arquivo: <strong>${file.name}</strong></li><li style="margin: 6px 0;">üîó URL: ${pdfUrl.substring(0, 60)}...</li><li style="margin: 6px 0;">‚úÖ O PDF est√° dispon√≠vel na p√°gina de captura!</li></ul>`;
                    msg.style.display = 'block';
                    msg.style.background = 'rgba(94,225,0,0.15)';
                    msg.style.borderColor = 'var(--tv-green)';
                    msg.style.color = 'var(--tv-black)';
                    console.log('‚úÖ Mensagem de sucesso do PDF exibida');
                    setTimeout(()=>{ 
                        msg.style.display = 'none'; 
                        msg.innerHTML = '‚úÖ Estat√≠sticas atualizadas com sucesso!';
                        msg.style.background = 'rgba(94,225,0,0.1)';
                    }, 6000);
                } else {
                    alert('‚úÖ PDF enviado com sucesso!\n\nüìÑ Arquivo: ' + file.name + '\n‚úÖ O PDF est√° dispon√≠vel na p√°gina de captura!');
                }
            } catch(e) {
                console.warn('Falha upload Storage:', e);
                const msg = document.getElementById('successMessage');
                if (msg) {
                    msg.textContent = '‚ùå Falha ao enviar PDF: ' + (e?.message || 'verifique o console');
                    msg.style.display = 'block';
                    setTimeout(()=>{ msg.style.display = 'none'; msg.textContent = '‚úÖ Estat√≠sticas atualizadas com sucesso!'; }, 3500);
                }
            }
        }

        function removePdf() {
            localStorage.removeItem('instagram_pdf');
            
            const preview = document.getElementById('preview-pdf');
            preview.innerHTML = '<div class="placeholder">Nenhum PDF carregado</div>';
            
            const removeBtn = preview.parentElement.querySelector('.remove-btn');
            if (removeBtn) removeBtn.style.display = 'none';
            
            document.getElementById('file-pdf').value = '';
        }

        // Fun√ß√£o para testar se a URL do PDF est√° acess√≠vel
        async function testPdfUrl(url) {
            try {
                console.log('üß™ Testando acesso ao PDF:', url);
                const testResponse = await fetch(url, { method: 'HEAD' });
                const isAccessible = testResponse.ok;
                console.log(`üìä PDF ${isAccessible ? '‚úÖ ACESS√çVEL' : '‚ùå INACESS√çVEL'} (Status: ${testResponse.status})`);
                return { accessible: isAccessible, status: testResponse.status };
            } catch(e) {
                console.error('‚ùå Erro ao testar URL do PDF:', e);
                return { accessible: false, status: 0, error: e.message };
            }
        }

        // Fun√ß√£o para baixar PDF do banco
        async function downloadPdfFromDatabase() {
            try {
                console.log('üì• Baixando PDF do banco...');
                console.log('üîç Verificando configura√ß√£o...');
                
                if (!window.SUPABASE_CONFIG) {
                    console.error('‚ùå SUPABASE_CONFIG n√£o encontrada');
                    alert('‚ùå Configura√ß√£o do Supabase n√£o encontrada\n\nVerifique se o arquivo supabase-config.js est√° carregado.');
                    return;
                }
                
                const supabaseUrl = window.SUPABASE_CONFIG.url;
                const supabaseServiceKey = window.SUPABASE_CONFIG.serviceKey;
                
                console.log('üìä Config encontrada:', {
                    url: supabaseUrl,
                    hasServiceKey: !!supabaseServiceKey
                });
                
                if (!supabaseServiceKey) {
                    console.error('‚ùå serviceKey n√£o configurada');
                    alert('‚ùå serviceKey n√£o configurada\n\nA chave de servi√ßo √© necess√°ria para acessar o banco de dados.');
                    return;
                }
                
                console.log('üîç Buscando PDF no banco...');
                const response = await fetch(
                    `${supabaseUrl}/rest/v1/instagram_capture_config?select=pdf_url,updated_at&order=updated_at.desc&limit=1`,
                    {
                        headers: {
                            'apikey': supabaseServiceKey,
                            'Authorization': `Bearer ${supabaseServiceKey}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                console.log('üì° Status da resposta:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå Erro HTTP:', response.status, errorText);
                    alert(`‚ùå Erro ao buscar PDF: HTTP ${response.status}\n\n${errorText.substring(0, 200)}`);
                    return;
                }
                
                const dataArray = await response.json();
                console.log('üìã Dados recebidos:', dataArray);
                console.log('üìä N√∫mero de registros:', dataArray?.length || 0);
                
                const data = (dataArray && dataArray.length > 0) ? dataArray[0] : null;
                const pdfUrl = data?.pdf_url || '';
                const updatedAt = data?.updated_at || '';
                
                console.log('üîó URL do PDF:', pdfUrl || 'vazia');
                console.log('üìÖ √öltima atualiza√ß√£o:', updatedAt || 'n√£o dispon√≠vel');
                
                if (!pdfUrl || !pdfUrl.startsWith('http')) {
                    const message = `‚ö†Ô∏è Nenhum PDF v√°lido encontrado no banco de dados\n\n` +
                                  `üìä Registros encontrados: ${dataArray?.length || 0}\n` +
                                  `üîó URL no banco: ${pdfUrl || '(vazio)'}\n` +
                                  `üìÖ √öltima atualiza√ß√£o: ${updatedAt ? new Date(updatedAt).toLocaleString('pt-BR') : 'n√£o dispon√≠vel'}\n\n` +
                                  `üí° Dica: Fa√ßa upload de um PDF usando o bot√£o "Selecionar PDF" acima.`;
                    console.warn('‚ö†Ô∏è', message);
                    alert(message);
                    return;
                }
                
                // Testar acesso antes de baixar
                console.log('üß™ Testando acesso ao PDF...');
                const testResult = await testPdfUrl(pdfUrl);
                console.log('üìä Resultado do teste:', testResult);
                
                if (!testResult.accessible) {
                    const message = `‚ö†Ô∏è PDF encontrado no banco, mas n√£o est√° acess√≠vel\n\n` +
                                  `üìä Status HTTP: ${testResult.status}\n` +
                                  `üîó URL: ${pdfUrl}\n\n` +
                                  `üí° Isso pode indicar:\n` +
                                  `‚Ä¢ Problema com o Storage do Supabase\n` +
                                  `‚Ä¢ Bucket n√£o est√° p√∫blico\n` +
                                  `‚Ä¢ Arquivo foi removido do Storage\n\n` +
                                  `Tente fazer upload novamente do PDF.`;
                    console.error('‚ùå PDF n√£o acess√≠vel:', testResult);
                    alert(message);
                    // Mesmo assim, tentar abrir
                    window.open(pdfUrl, '_blank');
                } else {
                    // Abrir em nova aba para download
                    console.log('‚úÖ PDF acess√≠vel! Abrindo para download...');
                    window.open(pdfUrl, '_blank');
                    console.log('‚úÖ PDF aberto para download:', pdfUrl);
                }
            } catch(e) {
                console.error('‚ùå Erro ao baixar PDF:', e);
                console.error('‚ùå Stack trace:', e.stack);
                alert(`‚ùå Erro ao baixar PDF: ${e.message}\n\nVerifique o console para mais detalhes.`);
            }
        }

        async function loadPdfPreview() {
            console.log('üîç loadPdfPreview() iniciado...');
            
            try {
                const preview = document.getElementById('preview-pdf');
                const downloadBtn = document.getElementById('btn-download-pdf');
                const statusInfo = document.getElementById('pdf-status-info');
                
                if (!preview) {
                    console.error('‚ùå Elemento preview-pdf n√£o encontrado no DOM');
                    return;
                }
                
                console.log('‚úÖ Elemento preview-pdf encontrado');
                
                // Status inicialmente oculto, mas bot√£o sempre vis√≠vel
                if (statusInfo) statusInfo.style.display = 'none';
                
                // FOR√áAR visibilidade dos bot√µes imediatamente
                if (downloadBtn) {
                    downloadBtn.style.display = 'inline-block';
                    downloadBtn.style.visibility = 'visible';
                    downloadBtn.style.opacity = '1';
                    console.log('‚úÖ Bot√£o de download FOR√áADO a aparecer:', {
                        display: downloadBtn.style.display,
                        computed: window.getComputedStyle(downloadBtn).display,
                        visibility: window.getComputedStyle(downloadBtn).visibility
                    });
                } else {
                    console.error('‚ùå Bot√£o de download N√ÉO encontrado no loadPdfPreview!');
                }
                
                const refreshBtn = document.getElementById('btn-refresh-pdf');
                if (refreshBtn) {
                    refreshBtn.style.display = 'inline-block';
                    refreshBtn.style.visibility = 'visible';
                    refreshBtn.style.opacity = '1';
                    console.log('‚úÖ Bot√£o de refresh FOR√áADO a aparecer');
                } else {
                    console.error('‚ùå Bot√£o de refresh N√ÉO encontrado no loadPdfPreview!');
                }
                
                // Mostrar loading
                preview.innerHTML = `
                    <div class="placeholder" style="padding: 20px; text-align: center; color: var(--tv-gray-medium);">
                        <p>‚è≥ Carregando PDF...</p>
                    </div>
                `;
                
                if (!window.SUPABASE_CONFIG) {
                    console.error('‚ùå Supabase config n√£o encontrada');
                    throw new Error('Configura√ß√£o do Supabase n√£o encontrada');
                }
                
                // Usar fetch direto (REST API) com serviceKey para garantir acesso
                const supabaseUrl = window.SUPABASE_CONFIG.url;
                const supabaseServiceKey = window.SUPABASE_CONFIG.serviceKey;
                
                if (!supabaseServiceKey) {
                    console.error('‚ùå serviceKey n√£o encontrada');
                    throw new Error('serviceKey n√£o configurada');
                }
                
                console.log('üîç Buscando PDF no banco via REST API...');
                console.log('üîó URL da API:', `${supabaseUrl}/rest/v1/instagram_capture_config`);
                
                const response = await fetch(
                    `${supabaseUrl}/rest/v1/instagram_capture_config?select=pdf_url,updated_at&order=updated_at.desc&limit=1`,
                    {
                        headers: {
                            'apikey': supabaseServiceKey,
                            'Authorization': `Bearer ${supabaseServiceKey}`,
                            'Content-Type': 'application/json'
                        }
                    }
                );
                
                console.log('üì° Status da resposta REST:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå Erro HTTP ao buscar PDF:', response.status, errorText);
                    
                    // Mostrar erro no status
                    if (statusInfo) {
                        statusInfo.style.display = 'block';
                        statusInfo.style.background = '#f8d7da';
                        statusInfo.style.color = '#721c24';
                        statusInfo.innerHTML = `‚ùå Erro ao acessar banco: HTTP ${response.status} - ${errorText.substring(0, 100)}`;
                    }
                    
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const dataArray = await response.json();
                console.log('üìã Dados recebidos do banco:', dataArray);
                console.log('üìä N√∫mero de registros:', dataArray?.length || 0);
                
                const data = (dataArray && dataArray.length > 0) ? dataArray[0] : null;
                const url = data?.pdf_url || '';
                const updatedAt = data?.updated_at || '';
                
                console.log('üîó URL do PDF encontrada:', url ? `${url.substring(0, 60)}...` : 'vazia');
                console.log('üìÖ √öltima atualiza√ß√£o:', updatedAt || 'n√£o dispon√≠vel');
                
                // Atualizar status info
                if (statusInfo) {
                    statusInfo.style.display = 'block';
                if (url) {
                        statusInfo.style.background = '#d1ecf1';
                        statusInfo.style.color = '#0c5460';
                        statusInfo.innerHTML = `‚úÖ PDF encontrado no banco! | √öltima atualiza√ß√£o: ${updatedAt ? new Date(updatedAt).toLocaleString('pt-BR') : 'n√£o dispon√≠vel'}`;
                    } else {
                        statusInfo.style.background = '#fff3cd';
                        statusInfo.style.color = '#856404';
                        statusInfo.innerHTML = '‚ö†Ô∏è Nenhum PDF encontrado no banco de dados';
                    }
                }
                
                // SEMPRE mostrar bot√£o de download (mesmo que n√£o haja URL, para permitir teste)
                if (downloadBtn) {
                    downloadBtn.style.display = 'inline-block';
                    if (!url || !url.startsWith('http')) {
                        downloadBtn.style.opacity = '0.6';
                        downloadBtn.style.cursor = 'not-allowed';
                        downloadBtn.title = 'Nenhum PDF encontrado no banco';
                    } else {
                        downloadBtn.style.opacity = '1';
                        downloadBtn.style.cursor = 'pointer';
                        downloadBtn.title = 'Clique para baixar o PDF do banco';
                    }
                    console.log('‚úÖ Bot√£o de download configurado:', downloadBtn.style.display, '| URL v√°lida:', !!url);
                } else {
                    console.error('‚ùå Bot√£o de download n√£o encontrado no DOM!');
                }
                
                if (url && url.trim() !== '' && url.startsWith('http')) {
                    // Testar se a URL est√° acess√≠vel
                    console.log('üß™ Testando acesso ao PDF...');
                    const testResult = await testPdfUrl(url);
                    
                    if (testResult.accessible) {
                        // PDF est√° acess√≠vel - mostrar preview
                    preview.innerHTML = `
                            <div style="background: #f8f9fa; border: 1px solid var(--tv-gray-border); border-radius: 8px; padding: 16px;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                                        <div>
                                            <p style="margin: 0; font-weight: 600; color: #333; font-size: 14px;">E-book PDF ‚úÖ</p>
                                            <p style="margin: 4px 0 0 0; font-size: 12px; color: #666;">Carregado do Storage | Status: ${testResult.status}</p>
                                        </div>
                                    </div>
                                    <a href="${url}" target="_blank" style="display: inline-block; padding: 6px 12px; background: var(--tv-green); color: var(--tv-black); text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 12px;">üìÑ Abrir</a>
                                </div>
                                <div style="background: white; border: 1px solid #ddd; border-radius: 4px; overflow: hidden; margin-top: 12px;">
                                    <iframe src="${url}" style="width: 100%; height: 500px; border: none;" title="Preview do PDF"></iframe>
                                </div>
                                <p style="font-size: 11px; color: #999; margin-top: 8px; word-break: break-all; text-align: center;">${url}</p>
                        </div>
                    `;
                        console.log('‚úÖ PDF exibido com sucesso na p√°gina de estat√≠sticas');
                    } else {
                        // PDF n√£o est√° acess√≠vel
                        preview.innerHTML = `
                            <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 16px;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#856404" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <line x1="12" y1="8" x2="12" y2="12"/>
                                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                                    </svg>
                                    <div>
                                        <p style="margin: 0; font-weight: 600; color: #856404; font-size: 14px;">‚ö†Ô∏è PDF Encontrado mas Inacess√≠vel</p>
                                        <p style="margin: 4px 0 0 0; font-size: 12px; color: #856404;">Status HTTP: ${testResult.status}</p>
                                    </div>
                                </div>
                                <p style="font-size: 12px; color: #856404; margin-bottom: 12px;">O PDF foi encontrado no banco de dados, mas n√£o est√° acess√≠vel pela URL fornecida. Isso pode indicar um problema com o Storage ou com as permiss√µes do bucket.</p>
                                <p style="font-size: 11px; color: #999; word-break: break-all; text-align: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid #ddd;">URL: ${url}</p>
                            </div>
                        `;
                        console.warn('‚ö†Ô∏è PDF encontrado mas n√£o acess√≠vel:', testResult);
                    }
                    
                    const removeBtn = preview.parentElement.querySelector('.remove-btn');
                    if (removeBtn) removeBtn.style.display = 'inline-block';
                } else {
                    // Mostrar placeholder quando n√£o h√° PDF
                    preview.innerHTML = `
                        <div class="placeholder" style="padding: 20px; text-align: center; color: var(--tv-gray-medium);">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin: 0 auto;">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            <p style="margin-top: 8px;">Nenhum PDF carregado</p>
                            <p style="font-size: 12px; margin-top: 4px;">Fa√ßa upload de um PDF acima</p>
                        </div>
                    `;
                    const removeBtn = preview.parentElement.querySelector('.remove-btn');
                    if (removeBtn) removeBtn.style.display = 'none';
                    console.warn('‚ö†Ô∏è Nenhum PDF encontrado no banco de dados');
                    
                    // Mesmo sem PDF, manter bot√£o vis√≠vel para permitir teste manual
                    if (downloadBtn) {
                        downloadBtn.style.display = 'inline-block';
                        downloadBtn.style.opacity = '0.6';
                        downloadBtn.style.cursor = 'not-allowed';
                        downloadBtn.title = 'Nenhum PDF encontrado no banco';
                        console.log('‚ö†Ô∏è Bot√£o mantido vis√≠vel mas desabilitado (sem PDF)');
                    }
                }
            } catch(e) {
                console.error('‚ùå Erro ao carregar preview do PDF:', e);
                const preview = document.getElementById('preview-pdf');
                if (preview) {
                    preview.innerHTML = `
                        <div class="placeholder" style="padding: 20px; text-align: center; color: var(--tv-danger);">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin: 0 auto;">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"/>
                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                            </svg>
                            <p style="margin-top: 8px; font-weight: 600;">‚ö†Ô∏è Erro ao carregar PDF</p>
                            <p style="font-size: 12px; margin-top: 4px;">${e.message || 'Verifique o console para detalhes'}</p>
                        </div>
                    `;
                }
            }
        }
    </script>
</body>
</html>
