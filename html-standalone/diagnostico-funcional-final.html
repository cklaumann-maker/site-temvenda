<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico TemVenda - Funcional</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .header {
            background: #5ee100;
            color: #000;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        .card {
            background: #111;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            background: #000;
            border: 1px solid #555;
            border-radius: 5px;
            color: #fff;
            box-sizing: border-box;
        }
        .btn {
            background: #5ee100;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #4bc800;
        }
        .btn-group {
            text-align: center;
            margin-top: 20px;
        }
        .help-box {
            background: rgba(94, 225, 0, 0.1);
            border: 1px solid rgba(94, 225, 0, 0.3);
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
            display: none;
        }
        .help-box.show {
            display: block;
        }
        .results {
            background: #111;
            border: 2px solid #5ee100;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .kpis {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .kpi {
            background: #222;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .kpi-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .kpi.ok .kpi-value { color: #84ff6a; }
        .kpi.warn .kpi-value { color: #ffd86a; }
        .kpi.risk .kpi-value { color: #ff7a7a; }
        .report {
            background: #000;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            margin: 15px 0;
        }
        .step-indicator {
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #5ee100;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Diagnóstico TemVenda</h1>
            <p>Como está sua empresa hoje?</p>
        </div>

        <div class="step-indicator" id="step-indicator">Etapa 1 de 5 - Seus dados</div>

        <form id="formDX">
            <!-- ETAPA 0 — Lead -->
            <div class="card" id="card-0">
                <h2>Seus dados</h2>
                <div class="form-group">
                    <label>Nome completo *</label>
                    <input id="lead_nome" required placeholder="Seu nome completo" />
                </div>
                <div class="form-group">
                    <label>Empresa *</label>
                    <input id="lead_empresa" required placeholder="Nome da empresa" />
                </div>
                <div class="form-group">
                    <label>Telefone *</label>
                    <input id="lead_tel" required placeholder="(DD) 90000-0000" />
                </div>
                <div class="form-group">
                    <label>E-mail *</label>
                    <input id="lead_email" type="email" required placeholder="voce@empresa.com.br" />
                </div>
                <div class="btn-group">
                    <button type="button" class="btn" onclick="validarLeadEProsseguir()">Começar diagnóstico</button>
                </div>
            </div>

            <!-- ETAPA 1 — Comercial -->
            <div class="card" id="card-1" style="display: none;">
                <h2>Gestão Comercial</h2>
                <div class="form-group">
                    <label>Possui orçamento de vendas?</label>
                    <select id="gc_orcamento" onchange="toggleHelp('gc_orcamento', 'gc_orcamento_help')">
                        <option value="">Selecione</option>
                        <option value="nao">Não</option>
                        <option value="sim">Sim</option>
                    </select>
                    <div id="gc_orcamento_help" class="help-box">
                        <strong>O que é orçamento de vendas?</strong><br>
                        É o planejamento financeiro que define quanto a empresa espera vender em um período (mensal, trimestral, anual). Serve como meta e referência para acompanhar o desempenho real versus o planejado.
                    </div>
                </div>

                <div class="form-group">
                    <label>Vendas atuais (R$)</label>
                    <input type="number" id="gc_vendas_atuais" min="0" step="0.01" placeholder="ex.: 320000" />
                </div>

                <div class="form-group">
                    <label>Possui campanhas de vendas?</label>
                    <select id="gc_campanhas" onchange="toggleHelp('gc_campanhas', 'gc_campanhas_help')">
                        <option value="">Selecione</option>
                        <option value="nao">Não</option>
                        <option value="sim">Sim</option>
                    </select>
                    <div id="gc_campanhas_help" class="help-box">
                        <strong>O que são campanhas de vendas?</strong><br>
                        São ações promocionais planejadas para aumentar vendas, como descontos, promoções, lançamentos de produtos, datas comemorativas, etc. Ajudam a impulsionar resultados e criar sazonalidade positiva.
                    </div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn" onclick="prevStep(1)">Voltar</button>
                    <button type="button" class="btn" onclick="nextStep(1)">Próximo</button>
                </div>
            </div>

            <!-- ETAPA 2 — Financeiro -->
            <div class="card" id="card-2" style="display: none;">
                <h2>Gestão Financeira</h2>
                <div class="form-group">
                    <label>Possui meta de CMV?</label>
                    <select id="gf_cmv_meta" onchange="toggleHelp('gf_cmv_meta', 'gf_cmv_help')">
                        <option value="">Selecione</option>
                        <option value="nao">Não</option>
                        <option value="sim">Sim</option>
                    </select>
                    <div id="gf_cmv_help" class="help-box">
                        <strong>O que é CMV?</strong><br>
                        CMV (Custo da Mercadoria Vendida) é o valor gasto para adquirir os produtos que foram vendidos.<br><br>
                        <strong>Como calcular CMV em %:</strong> (CMV ÷ Vendas) × 100<br>
                        <strong>Exemplo:</strong> Se CMV = R$ 70.000 e Vendas = R$ 100.000, então CMV = 70%<br><br>
                        <strong>Referências:</strong><br>
                        • <strong>Saudável:</strong> abaixo de 65%<br>
                        • <strong>Estável:</strong> entre 65% e 75%<br>
                        • <strong>Ruim:</strong> acima de 75%
                    </div>
                </div>

                <div class="form-group">
                    <label>CMV atual (%)</label>
                    <input type="number" id="gf_cmv_atual" min="0" max="100" step="0.1" placeholder="ex.: 70" />
                </div>

                <div class="form-group">
                    <label>Seu caixa está positivo?</label>
                    <select id="gf_caixa_pos">
                        <option value="">Selecione</option>
                        <option value="sim">Sim</option>
                        <option value="nao">Não</option>
                    </select>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn" onclick="prevStep(2)">Voltar</button>
                    <button type="button" class="btn" onclick="nextStep(2)">Próximo</button>
                </div>
            </div>

            <!-- ETAPA 3 — Operação -->
            <div class="card" id="card-3" style="display: none;">
                <h2>Gestão da Operação</h2>
                <div class="form-group">
                    <label>Checklist de operação?</label>
                    <select id="go_checklist" onchange="toggleHelp('go_checklist', 'go_checklist_help')">
                        <option value="">Selecione</option>
                        <option value="sim">Sim</option>
                        <option value="nao">Não</option>
                    </select>
                    <div id="go_checklist_help" class="help-box">
                        <strong>O que é checklist de operação?</strong><br>
                        São listas de verificação para padronizar processos diários, semanais e mensais.<br><br>
                        <strong>Exemplos de checklist:</strong><br>
                        • <strong>Abertura:</strong> conferir caixa, ligar equipamentos, verificar preços<br>
                        • <strong>Durante o dia:</strong> manter estoque organizado, limpeza, atendimento<br>
                        • <strong>Fechamento:</strong> conferir vendas, fechar caixa, organizar estoque<br><br>
                        <strong>Benefícios:</strong> Reduz erros, melhora qualidade e aumenta produtividade.
                    </div>
                </div>

                <div class="form-group">
                    <label>Padrão de atendimento?</label>
                    <select id="go_padrao" onchange="toggleHelp('go_padrao', 'go_padrao_help')">
                        <option value="">Selecione</option>
                        <option value="sim">Sim</option>
                        <option value="nao">Não</option>
                    </select>
                    <div id="go_padrao_help" class="help-box">
                        <strong>O que é padrão de atendimento?</strong><br>
                        É um roteiro padronizado para o atendimento ao cliente, garantindo qualidade e consistência.<br><br>
                        <strong>Roteiro básico:</strong><br>
                        1. <strong>Abordagem:</strong> Cumprimentar com sorriso<br>
                        2. <strong>Escuta ativa:</strong> Entender a necessidade do cliente<br>
                        3. <strong>Recomendação:</strong> Sugerir produtos adequados<br>
                        4. <strong>Fechamento:</strong> Confirmar a compra<br>
                        5. <strong>Pós-venda:</strong> Orientar sobre uso e garantia<br><br>
                        <strong>Benefícios:</strong> Aumenta satisfação do cliente e vendas.
                    </div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn" onclick="prevStep(3)">Voltar</button>
                    <button type="button" class="btn" onclick="nextStep(3)">Próximo</button>
                </div>
            </div>

            <!-- ETAPA 4 — Negócio -->
            <div class="card" id="card-4" style="display: none;">
                <h2>Gestão do Negócio</h2>
                <div class="form-group">
                    <label>Quantidade de lojas</label>
                    <input type="number" id="gn_lojas" min="1" step="1" placeholder="ex.: 1" />
                </div>
                <div class="form-group">
                    <label>Quantidade de colaboradores</label>
                    <input type="number" id="gn_colab" min="1" step="1" placeholder="ex.: 12" />
                </div>
                <div class="form-group">
                    <label>Você gostaria de conhecer nosso trabalho de consultoria?</label>
                    <select id="gn_q_consultoria" required>
                        <option value="">Selecione</option>
                        <option value="sim">Sim</option>
                        <option value="nao">Não</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Você gostaria que eu contatasse seu time para apresentar a Formação?</label>
                    <select id="gn_q_formacao" required>
                        <option value="">Selecione</option>
                        <option value="sim">Sim</option>
                        <option value="nao">Não</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn" onclick="prevStep(4)">Voltar</button>
                    <button type="button" class="btn" onclick="gerarRelatorio()">Gerar relatório</button>
                </div>
            </div>
        </form>

        <!-- RESULTADO -->
        <div id="resultado" class="results">
            <h2>Seu diagnóstico completo</h2>
            <div class="kpis">
                <div class="kpi" id="kpi-fin">
                    <div>Financeiro</div>
                    <div class="kpi-value" id="k_fin">–</div>
                    <div id="t_fin"></div>
                </div>
                <div class="kpi" id="kpi-ops">
                    <div>Operação</div>
                    <div class="kpi-value" id="k_ops">–</div>
                    <div id="t_ops"></div>
                </div>
                <div class="kpi" id="kpi-com">
                    <div>Comercial</div>
                    <div class="kpi-value" id="k_com">–</div>
                    <div id="t_com"></div>
                </div>
            </div>
            <div class="report" id="report"></div>
            <div class="btn-group">
                <button class="btn" onclick="copiarRelatorio()">Copiar</button>
                <button class="btn" onclick="window.print()">Imprimir</button>
                <a id="whats_btn" class="btn" href="#" target="_blank">WhatsApp</a>
                <a id="mail_btn" class="btn" href="#" target="_blank">E-mail</a>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0;
        const totalSteps = 5;

        // Atualizar indicador de etapa
        function updateStepIndicator(step) {
            const stepNames = [
                'Etapa 1 de 5 - Seus dados',
                'Etapa 2 de 5 - Gestão Comercial',
                'Etapa 3 de 5 - Gestão Financeira',
                'Etapa 4 de 5 - Gestão da Operação',
                'Etapa 5 de 5 - Gestão do Negócio'
            ];
            document.getElementById('step-indicator').textContent = stepNames[step];
        }

        // Navegação
        function showStep(n) {
            // Esconder todos os cards
            for (let i = 0; i < totalSteps; i++) {
                const card = document.getElementById('card-' + i);
                if (card) {
                    card.style.display = 'none';
                }
            }
            
            // Mostrar card atual
            const currentCard = document.getElementById('card-' + n);
            if (currentCard) {
                currentCard.style.display = 'block';
            }
            
            currentStep = n;
            updateStepIndicator(n);
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function nextStep(n) { 
            showStep(n + 1); 
        }
        
        function prevStep(n) { 
            showStep(n - 1); 
        }

        // Validação Lead
        function validarLeadEProsseguir() {
            const nome = document.getElementById('lead_nome').value.trim();
            const empresa = document.getElementById('lead_empresa').value.trim();
            const tel = document.getElementById('lead_tel').value.trim();
            const email = document.getElementById('lead_email').value.trim();
            
            if (!nome || !empresa || !tel || !email) {
                alert('Preencha todos os campos obrigatórios.');
                return;
            }
            
            nextStep(0);
        }

        // Sistema de Help Boxes
        function toggleHelp(selectId, helpId) {
            const select = document.getElementById(selectId);
            const help = document.getElementById(helpId);
            
            if (select && help) {
                if (select.value === 'nao') {
                    help.classList.add('show');
                } else {
                    help.classList.remove('show');
                }
            }
        }

        // Sistema de Scores
        function scoreFinanceiro({cmv, caixaPos}) {
            let s = 0;
            if (cmv !== null) {
                if (cmv < 65) s += 50;
                else if (cmv <= 75) s += 35;
                else s += 20;
            } else s += 30;
            
            s += (caixaPos === 'sim') ? 30 : 10;
            
            return Math.min(100, Math.round(s));
        }

        function scoreComercial({orc, campanhas}) {
            let s = 50; // Base
            s += (orc === 'sim') ? 25 : 10;
            s += (campanhas === 'sim') ? 25 : 10;
            return Math.min(100, Math.round(s));
        }

        function scoreOps({checklist, padrao}) {
            let s = 50; // Base
            s += (checklist === 'sim') ? 25 : 10;
            s += (padrao === 'sim') ? 25 : 10;
            return Math.min(100, Math.round(s));
        }

        const tagByScore = s => (s >= 75 ? {txt: 'Saudável', cls: 'ok'} : s >= 50 ? {txt: 'Atenção', cls: 'warn'} : {txt: 'Risco', cls: 'risk'});

        // Geração de Relatório
        function gerarRelatorio() {
            const interesseConsultoria = document.getElementById('gn_q_consultoria').value;
            const interesseFormacao = document.getElementById('gn_q_formacao').value;
            
            if (!interesseConsultoria || !interesseFormacao) {
                alert('Responda às duas perguntas finais.');
                showStep(4);
                return;
            }

            const lead = {
                nome: document.getElementById('lead_nome').value,
                empresa: document.getElementById('lead_empresa').value,
                tel: document.getElementById('lead_tel').value,
                email: document.getElementById('lead_email').value
            };

            const vendas = Number(document.getElementById('gc_vendas_atuais').value || 0);

            const gc = {
                orc: document.getElementById('gc_orcamento').value,
                vendasAtuais: vendas,
                campanhas: document.getElementById('gc_campanhas').value
            };

            const gf = {
                cmvMeta: document.getElementById('gf_cmv_meta').value,
                cmvAtual: Number(document.getElementById('gf_cmv_atual').value || 0),
                caixaPos: document.getElementById('gf_caixa_pos').value
            };

            const go = {
                checklist: document.getElementById('go_checklist').value,
                padrao: document.getElementById('go_padrao').value
            };

            const lojas = Number(document.getElementById('gn_lojas').value || 1);
            const colab = Number(document.getElementById('gn_colab').value || 1);

            const finScore = scoreFinanceiro({
                cmv: gf.cmvAtual || null,
                caixaPos: gf.caixaPos
            });

            const comScore = scoreComercial({
                orc: gc.orc,
                campanhas: gc.campanhas
            });

            const opsScore = scoreOps({
                checklist: go.checklist,
                padrao: go.padrao
            });

            const finTag = tagByScore(finScore);
            const comTag = tagByScore(comScore);
            const opsTag = tagByScore(opsScore);

            // Atualizar KPIs
            document.getElementById('k_fin').textContent = finScore + '/100';
            document.getElementById('k_fin').className = 'kpi-value ' + finTag.cls;
            document.getElementById('t_fin').textContent = finTag.txt;

            document.getElementById('k_ops').textContent = opsScore + '/100';
            document.getElementById('k_ops').className = 'kpi-value ' + opsTag.cls;
            document.getElementById('t_ops').textContent = opsTag.txt;

            document.getElementById('k_com').textContent = comScore + '/100';
            document.getElementById('k_com').className = 'kpi-value ' + comTag.cls;
            document.getElementById('t_com').textContent = comTag.txt;

            // Atualizar classes dos KPIs
            document.getElementById('kpi-fin').className = 'kpi ' + finTag.cls;
            document.getElementById('kpi-ops').className = 'kpi ' + opsTag.cls;
            document.getElementById('kpi-com').className = 'kpi ' + comTag.cls;

            const resumo = `DADOS DO CONTATO
- Nome: ${lead.nome}
- Empresa: ${lead.empresa}
- Telefone: ${lead.tel}
- E-mail: ${lead.email}

RESUMO EXECUTIVO
- Financeiro: ${finScore}/100 (${finTag.txt})
- Operação/Pessoas: ${opsScore}/100 (${opsTag.txt})
- Comercial: ${comScore}/100 (${comTag.txt})

GESTÃO COMERCIAL
- Orçamento: ${gc.orc}
- Vendas atuais: R$ ${vendas.toLocaleString('pt-BR')}
- Campanhas: ${gc.campanhas || '—'}

GESTÃO FINANCEIRA
- CMV meta: ${gf.cmvMeta || '—'}
- CMV atual: ${gf.cmvAtual || '—'}%
- Caixa positivo: ${gf.caixaPos || '—'}

GESTÃO DA OPERAÇÃO
- Checklist: ${go.checklist || '—'}
- Padrão de atendimento: ${go.padrao || '—'}

GESTÃO DO NEGÓCIO
- Lojas: ${lojas}
- Colaboradores: ${colab}

INTERESSE EM SOLUÇÕES TEM VENDA
- Conhecer consultoria: ${interesseConsultoria}
- Contato para Formação: ${interesseFormacao}

PRÓXIMOS PASSOS
• Entre em contato para um plano personalizado
• Telefone: (48) 99157-5566
• E-mail: contato@temvenda.com.br`;

            document.getElementById('report').textContent = resumo;
            document.getElementById('resultado').style.display = 'block';

            const msg = encodeURIComponent("Diagnóstico • TEM VENDA\n\n" + resumo + "\nQuero um plano de 90 dias.");
            document.getElementById('whats_btn').href = "https://wa.me/5548991575566?text=" + msg;
            const assunto = encodeURIComponent("Diagnóstico TEM VENDA - " + lead.empresa);
            document.getElementById('mail_btn').href = "mailto:" + lead.email + "?subject=" + assunto + "&body=" + encodeURIComponent(resumo);

            window.scrollTo({top: document.getElementById('resultado').offsetTop, behavior: 'smooth'});
        }

        function copiarRelatorio() {
            const txt = document.getElementById('report').textContent;
            navigator.clipboard.writeText(txt).then(() => {
                alert('Relatório copiado!');
            }).catch(() => {
                alert('Não foi possível copiar.');
            });
        }

        // Inicializar
        showStep(0);
    </script>
</body>
</html>
